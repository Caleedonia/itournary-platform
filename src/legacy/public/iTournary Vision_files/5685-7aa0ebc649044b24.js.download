"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5685],{88359:(e,t,s)=>{s.d(t,{_:()=>n});var i=s(16834);class a{getItem(e){let t=localStorage.getItem(i.d5[e]);if(t)try{var s;return null!==(s=JSON.parse(t))&&void 0!==s?s:null}catch(e){}return null}setItem(e,t){localStorage.setItem(i.d5[e],JSON.stringify(t))}}let n=new a},5685:(e,t,s)=>{s.d(t,{M_:()=>T,jL:()=>E,GV:()=>C});var i=s(34137),a=s(40757),n=s(25087),r=s(85799),o=s(13522),l=s(17029),d=s(80602),c=s(88672),p=s(92264),u=s(52658),g=s(16834);s(23693),s(57148);var m=s(10424),f=s(17923),y=s(92749),h=s(34655),v=s(87963),b=s(60537),S=s(67887),w=s(77883),L=s(4331),I=s(92099);BigInt.prototype.toJSON=function(){return Number(this)};let M=(0,o.HY)({[m.q.reducerPath]:m.q.reducer,chat:y.V.reducer,auth:a.R.reducer,websocket:r.M.reducer,sessions:n.u.reducer,sessionSwitch:I.$.reducer,agentWorkspace:i.V.reducer,knowledge:w.P.reducer,configs:v.e.reducer,biz:f.M.reducer,notification:L.y.reducer,community:h.C.reducer,fileManagement:S.K.reducer,connectors:b.h.reducer}),x=(0,p.rL)({key:g.cO,version:8,storage:u.A,whitelist:["configs"],async migrate(e,t){var s;if((null==e?void 0:null===(s=e._persist)||void 0===s?void 0:s.version)===t)return e}},M),E=c.wA.withTypes(),C=c.d4.withTypes();c.Pj.withTypes();let T=(()=>{let e=(0,l.U1)({reducer:x,middleware:e=>e({serializableCheck:!1}).concat(m.q.middleware)});return(0,d.$k)(e.dispatch),e})()},10424:(e,t,s)=>{s.d(t,{q:()=>o});var i=s(12766),a=s(27080),n=s(80602),r=s(24990);let o=(0,a.xP)({reducerPath:"api",baseQuery:async(e,t,s)=>{let a=await (0,n.cw)({baseUrl:"prod"===i.a.mod?i.a.serverUrl:"/",prepareHeaders:async e=>await (0,r.q)(e)})(e,t,s);if(a.error)return a;let o=a.data;if(o.error){var l,d;return{error:{status:(null===(d=a.meta)||void 0===d?void 0:null===(l=d.response)||void 0===l?void 0:l.status)||400,data:o.error}}}return{data:o.data}},tagTypes:["Sessions","Uploads"],endpoints:()=>({})})},23693:(e,t,s)=>{s.d(t,{R:()=>r});var i=s(26865),a=s(10424),n=s(23254);let r=a.q.injectEndpoints({endpoints:e=>({getSession:e.query({query:(0,n.V)(i.nC.chat.getSession),keepUnusedDataFor:0}),deleteSession:e.query({query:(0,n.V)(i.nC.chat.deleteSession),keepUnusedDataFor:0}),getVscodeOtp:e.query({query:(0,n.V)(i.nC.chat.getVscodeOtp),keepUnusedDataFor:0,forceRefetch:()=>!0}),getVncOtp:e.query({query:(0,n.V)(i.nC.chat.getVncOtp),keepUnusedDataFor:0,forceRefetch:()=>!0})})}),{useGetSessionQuery:o}=r},57148:(e,t,s)=>{s.d(t,{Ef:()=>r});var i=s(26865),a=s(10424),n=s(23254);let r=a.q.injectEndpoints({endpoints:e=>({getPresignedUrl:e.query({query:(0,n.V)(i.nC.chat.getPresignedUploadUrl)}),completeUpload:e.mutation({query:(0,n.V)(i.nC.chat.uploadComplete),invalidatesTags:["Sessions"]}),uploadToS3:e.mutation({queryFn:async e=>{let{url:t,file:s,onProgress:a}=e;try{return await new Promise((e,n)=>{let r=new XMLHttpRequest;r.upload.addEventListener("progress",e=>{if(e.lengthComputable&&a){let t=Math.round(e.loaded/e.total*100);a(t)}}),r.addEventListener("load",()=>{200===r.status?e():n(Error("Upload failed with status ".concat(r.status)))}),r.addEventListener("error",()=>{n(Error("Upload failed"))}),r.open("PUT",t),r.setRequestHeader("Content-Type",s.type);let o=s.type.includes("application/pdf")?"inline":void 0,l=(0,i.$j)(s.name,o);l&&r.setRequestHeader("Content-Disposition",l),r.send(s)}),{data:"ok"}}catch(e){return{error:{status:"CUSTOM_ERROR",error:e instanceof Error?e.message:"Upload failed"}}}}}),getDownloadUrl:e.query({query:(0,n.V)(i.nC.chat.getDownloadUrl)})})}),{useGetPresignedUrlQuery:o,useCompleteUploadMutation:l}=r},23254:(e,t,s)=>{s.d(t,{V:()=>i});function i(e){return t=>({url:e.route,method:e.method,params:["GET","DELETE"].includes(e.method)?t:void 0,body:["GET","DELETE"].includes(e.method)?void 0:t})}},34137:(e,t,s)=>{s.d(t,{V:()=>i});let i=(0,s(17029).Z0)({name:"agentWorkspace",initialState:{sidebarType:null,isSidebarFullscreen:!1,isSidebarHovering:!1,isSidebarVisibleInMobile:!1,sidebarLocation:"inside",filePreviewProps:null,animationLock:!1,isTimelinePlaying:!1,vncDialogVisible:!1,initialComputerPosition:{top:0,left:0,width:0,height:0}},reducers:{setSidebarType(e,t){e.sidebarType=t.payload},setSidebarLocation(e,t){e.sidebarLocation=t.payload},setFilePreviewerProps(e,t){e.filePreviewProps=t.payload},setAnimationLock(e,t){e.animationLock=t.payload},setIsSidebarHovering:(e,t)=>{e.isSidebarHovering=t.payload},setTimelinePlaying:(e,t)=>{e.isTimelinePlaying=t.payload},setVncDialogVisible:(e,t)=>{if(e.vncDialogVisible=t.payload.visible,!t.payload.fromUrlChange){let t=new URL(window.location.href);e.vncDialogVisible?t.searchParams.set("vnc","1"):t.searchParams.delete("vnc"),window.history.pushState({vncDialogVisible:e.vncDialogVisible},"",t.toString())}},setIsSidebarVisibleInMobile:(e,t)=>{e.isSidebarVisibleInMobile=t.payload},setIsSidebarFullscreen:(e,t)=>{e.isSidebarFullscreen=t.payload},setInitialComputerPosition:(e,t)=>{e.initialComputerPosition=t.payload}},selectors:{sidebarType:e=>e.sidebarType,sidebarLocation:e=>e.sidebarLocation,isSidebarOpen:e=>null!==e.sidebarType,filePreviewerProps:e=>e.filePreviewProps,animationLock:e=>e.animationLock,isSidebarVisibleInMobile:e=>e.isSidebarVisibleInMobile,isSidebarHovering:e=>e.isSidebarHovering,isTimelinePlaying:e=>e.isTimelinePlaying,vncDialogVisible:e=>e.vncDialogVisible,isSidebarFullscreen:e=>e.isSidebarFullscreen,initialComputerPosition:e=>e.initialComputerPosition}})},17923:(e,t,s)=>{s.d(t,{M:()=>d});var i=s(16834),a=s(17029),n=s(19208),r=s(88435),o=s(93847);let l={loadingKey:null,planList:r.pE,addOnList:r.G,subscriptions:[]},d=(0,a.Z0)({name:"biz",initialState:l,reducers:{showLoading(e,t){e.loadingKey=t.payload},hideLoading(e){e.loadingKey=null},initData(e){let t=(0,o.s2)(i.d5.bizPlanList,r.pE),s=(0,o.s2)(i.d5.bizAddonList,r.G),a=(0,o.s2)(i.d5.subscriptions,[]);e.planList=t,e.addOnList=s,e.subscriptions=a},updateAddonList(e,t){e.addOnList=t.payload,localStorage.setItem(i.d5.bizAddonList,JSON.stringify(t.payload))},updateSubscriptions(e,t){e.subscriptions=t.payload,localStorage.setItem(i.d5.subscriptions,JSON.stringify(t.payload))},updatePlanList(e,t){e.planList=t.payload,localStorage.setItem(i.d5.bizPlanList,JSON.stringify(t.payload))}},selectors:{loadingKey:e=>e.loadingKey,subscriptions:e=>e.subscriptions,planList:(0,n.Mz)(e=>e.subscriptions,e=>r.h3.flatMap(t=>{let s=e.find(e=>(0,o.wZ)(e.plan)===t.plan);if(!s)return[];let i=(0,o.wZ)(s.plan);if(!i)return[];let a={...t,...s,plan:i,benefits:[]};return a.benefits=t.getBenefits(a),[a]})),addOnList:e=>e.addOnList,addOnUsage:(0,n.Mz)(e=>e.addOnList,e=>{let t={};return e.map(e=>{t[e.plan]=e.credits}),t})}})},88435:(e,t,s)=>{s.d(t,{IO:()=>v,h3:()=>S,HV:()=>b,G:()=>h,pE:()=>y});var i=s(2635),a=s(93578);function n(e){let{size:t,color:s="currentColor"}=e;return(0,i.jsxs)("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("path",{d:"M13.3333 5.33594H2.66667C2.29848 5.33594 2 5.63441 2 6.0026V7.33594C2 7.70413 2.29848 8.0026 2.66667 8.0026H13.3333C13.7015 8.0026 14 7.70413 14 7.33594V6.0026C14 5.63441 13.7015 5.33594 13.3333 5.33594Z",stroke:s,strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}),(0,i.jsx)("path",{d:"M8 5.33594L8 8.00195",stroke:s,strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}),(0,i.jsx)("path",{d:"M12.6654 8V13C12.6654 13.5523 12.2176 14 11.6654 14C9.22092 14 6.77647 14 4.33203 14C3.77975 14 3.33203 13.5523 3.33203 13V8",stroke:s,strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}),(0,i.jsx)("path",{d:"M4.9987 5.33362C4.55667 5.33362 4.13275 5.15803 3.82019 4.84547C3.50763 4.53291 3.33203 4.10899 3.33203 3.66696C3.33203 3.22493 3.50763 2.80101 3.82019 2.48845C4.13275 2.17589 4.55667 2.00029 4.9987 2.00029C5.64182 1.98909 6.27205 2.30113 6.80719 2.89573C7.34233 3.49033 7.75755 4.33989 7.9987 5.33362C8.23985 4.33989 8.65507 3.49033 9.19021 2.89573C9.72535 2.30113 10.3556 1.98909 10.9987 2.00029C11.4407 2.00029 11.8646 2.17589 12.1772 2.48845C12.4898 2.80101 12.6654 3.22493 12.6654 3.66696C12.6654 4.10899 12.4898 4.53291 12.1772 4.84547C11.8646 5.15803 11.4407 5.33362 10.9987 5.33362",stroke:s,strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"})]})}function r(e){let{color:t="var(--icon-primary)",size:s=16,...a}=e;return(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"none",width:s,height:s,color:t,...a,children:(0,i.jsx)("path",{d:"M13.5867 2.97333L10.6667 2C10.6667 2.70724 10.3857 3.38552 9.88564 3.88562C9.38555 4.38572 8.70727 4.66667 8.00003 4.66667C7.29278 4.66667 6.61451 4.38572 6.11441 3.88562C5.61431 3.38552 5.33336 2.70724 5.33336 2L2.41336 2.97333C2.11162 3.07386 1.85575 3.27894 1.69193 3.55156C1.52811 3.82418 1.46715 4.14638 1.52003 4.46L1.90669 6.77333C1.93208 6.92994 2.01248 7.07236 2.13345 7.17501C2.25443 7.27765 2.40804 7.33379 2.56669 7.33333H4.00003V13C4.00003 13.7333 4.60003 14.3333 5.33336 14.3333H10.6667C11.0203 14.3333 11.3595 14.1929 11.6095 13.9428C11.8596 13.6928 12 13.3536 12 13V7.33333H13.4334C13.592 7.33379 13.7456 7.27765 13.8666 7.17501C13.9876 7.07236 14.068 6.92994 14.0934 6.77333L14.48 4.46C14.5329 4.14638 14.4719 3.82418 14.3081 3.55156C14.1443 3.27894 13.8884 3.07386 13.5867 2.97333Z",stroke:"currentColor",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"})})}r._id="2e59479ac97c8f210ed5a882d75f92d0";let o={src:"https://files.manuscdn.com/webapp/_next/static/media/PerkGift.30c0f4e7.webp"};var l=s(26865),d=s(57271),c=s(73518),p=s(18184),u=s(93847),g=s(28715);let m={planType:p.OL.CASUAL,price:199,credits:19900,discountPrice:0},f={planType:p.OL.PRO,price:39,credits:3900,discountPrice:0},y=[{planType:p.OL.LITE,price:19,credits:1900,discountPrice:0},m,f],h=[{plan:p.zl.CREDITS_2000,credits:1900,price:19},{plan:p.zl.CREDITS_10000,credits:9900,price:99},{plan:p.zl.CREDITS_19900,credits:19900,price:199}],v=[p.zl.CREDITS_2000,p.zl.CREDITS_10000,p.zl.CREDITS_19900],b=[p.zl.LITE_MONTHLY,p.zl.LITE_YEARLY,p.zl.CASUAL_MONTHLY,p.zl.PRO_MONTHLY,p.zl.CASUAL_YEARLY,p.zl.PRO_YEARLY],S=[{plan:p.OL.LITE,planName:"Basic",maxConcurrentTask:2,sandboxRetentionDays:3,credits:1900,supportHighEfforts:!1,title:"".concat(l.KR," Basic"),featureList:["credit","concurrent"],getBenefits:e=>[{label:d.I.t(g.Z.credits,{credits:(0,l.Ql)(e.credits)})},{icon:n,badge:d.I.t("<limited>LIMITED OFFER</limited>"),label:d.I.t("<b>+{credits}</b> extra credits first month",{credits:(0,l.Ql)(e.credits)}),match:e=>!(0,u.Tw)(null==e?void 0:e.membershipVersion)},{icon:n,badge:d.I.t("<limited>LIMITED OFFER</limited>"),label:d.I.t("<b>+{credits}</b> extra credits per month",{credits:(0,l.Ql)(e.credits)}),match:e=>!!(0,u.Tw)(null==e?void 0:e.membershipVersion)},{label:d.I.t(g.Z.concurrent,{concurrentTasks:e.maxConcurrentTask})},{label:g.Z.stability},{label:g.Z.extendedCtx},{label:g.Z.priorityAccess}]},{plan:p.OL.CASUAL,planName:"Plus",maxConcurrentTask:2,sandboxRetentionDays:3,credits:3900,supportHighEfforts:!1,title:"".concat(l.KR," Plus"),featureList:["credit","concurrent"],getBenefits:e=>[{label:d.I.t(g.Z.credits,{credits:(0,l.Ql)(e.credits)})},{icon:n,badge:d.I.t("<limited>LIMITED OFFER</limited>"),label:d.I.t("<b>+{credits}</b> extra credits first month",{credits:(0,l.Ql)(e.credits)}),match:e=>!(0,u.Tw)(null==e?void 0:e.membershipVersion)},{icon:n,badge:d.I.t("<limited>LIMITED OFFER</limited>"),label:d.I.t("<b>+{credits}</b> extra credits per month",{credits:(0,l.Ql)(e.credits)}),match:e=>!!(0,u.Tw)(null==e?void 0:e.membershipVersion)},{label:d.I.t(g.Z.concurrent,{concurrentTasks:e.maxConcurrentTask})},{label:g.Z.stability},{label:g.Z.extendedCtx},{label:g.Z.priorityAccess}]},{plan:p.OL.PRO,planName:"Pro",credits:19900,supportHighEfforts:!0,maxConcurrentTask:5,sandboxRetentionDays:7,title:"".concat(l.KR," Pro"),featureList:["credit","concurrent","effort","spaceDomain"],getBenefits:e=>[{label:d.I.t(g.Z.credits,{credits:(0,l.Ql)(e.credits)})},{icon:n,badge:d.I.t("<limited>LIMITED OFFER</limited>"),label:d.I.t("<b>+{credits}</b> extra credits first month",{credits:(0,l.Ql)(e.credits)}),match:e=>!(0,u.Tw)(null==e?void 0:e.membershipVersion)},{icon:n,badge:d.I.t("<limited>LIMITED OFFER</limited>"),label:d.I.t("<b>+{credits}</b> extra credits per month",{credits:(0,l.Ql)(e.credits)}),match:e=>!!(0,u.Tw)(null==e?void 0:e.membershipVersion)},{match:e=>!!(null==e?void 0:e.perks),icon:r,label:(0,i.jsxs)(i.Fragment,{children:[d.I.t("Exclusive {product} T-shirt included",{product:l.KR}),(0,i.jsx)(a.A,{trigger:"hover",placement:"top",content:(0,i.jsxs)("div",{className:"w-[260px] max-w-[90%] cursor-help p-[10px] flex flex-col gap-[10px] rounded-[12px] border-[0.5px] border-[var(--border-dark)] bg-[var(--background-menu-white)] shadow-[0px_4px_11px_0px_var(--shadow-M)]",children:[(0,i.jsxs)("div",{className:"w-full",children:[(0,i.jsx)("p",{className:'text-[var(--text-primary)] font-["SF_Pro"] text-[13px] font-[500] leading-[18px]',children:d.I.t("After subscribing, you'll receive an email prompting you to provide your delivery address.")}),(0,i.jsx)("p",{className:'text-[var(--text-tertiary)] font-["SF_Pro"] text-xs mt-1',children:d.I.t("Currently only available in Austria, Belgium, Czech Republic, Denmark, Finland, France, Germany, Greece, Hungary, Ireland, Italy, Japan, Luxembourg, Netherlands, Poland, Sweden, and USA due to our partner's shipping capabilities.")})]}),(0,i.jsx)("img",{src:o.src,className:"w-full h-auto"})]}),children:(0,i.jsx)(c.A,{size:16,color:"var(--icon-tertiary)",className:"relative top-[-1px] ml-[4px] inline-block cursor-help"})})]})},{label:d.I.t(g.Z.concurrent,{concurrentTasks:e.maxConcurrentTask})},{label:g.Z.highEfforts},{label:g.Z.stability},{label:g.Z.extendedCtx},{label:g.Z.priorityAccess}]}]},28715:(e,t,s)=>{s.d(t,{Z:()=>n,r:()=>r});var i=s(57271),a=s(18184);let n={get credits(){return i.I.t("<b>{credits}</b> credits per month <link>Learn more</link>")},get creditsBonus(){return i.I.t("<b>{credits}</b> bonus credits when you renew")},get concurrent(){return i.I.t("Run up to <b>{concurrentTasks}</b> tasks concurrently")},get highEfforts(){return i.I.t("Access to high-effort mode and other beta features")},get stability(){return i.I.t("Enhanced stability with dedicated resources")},get extendedCtx(){return i.I.t("Extended context length")},get priorityAccess(){return i.I.t("Priority access during peak hours")}},r={get[a.OL.LITE](){return[n.credits,n.creditsBonus,n.concurrent]},get[a.OL.CASUAL](){return[n.credits,n.creditsBonus,n.concurrent]},get[a.OL.PRO](){return[n.credits,n.creditsBonus,n.concurrent]}}},92749:(e,t,s)=>{s.d(t,{V:()=>n});var i=s(17029),a=s(19208);let n=(0,i.Z0)({name:"chat",initialState:{files:[],chatQuote:null,inputValue:"",quoteMessageId:null,autoPreviewFile:null,previewingFileUrl:null,showSharePopover:null,effort:"standard",inputMode:"text",microphonePermission:"prompt"},reducers:{afterSendQuestion:e=>{e.files=[],e.chatQuote=null,e.quoteMessageId=null,e.effort="standard"},fileAdded:(e,t)=>{e.files.unshift(t.payload)},fileIdGenerated:(e,t)=>{let{tempId:s,realId:i}=t.payload,a=e.files.findIndex(e=>e.id===s);-1!==a&&(e.files[a].id=i)},fileRemoved:(e,t)=>{e.files=e.files.filter(e=>e.id!==t.payload)},fileProgressUpdated:(e,t)=>{let s=e.files.find(e=>e.id===t.payload.id);s&&(100===t.payload.progress?s.status="pending":s.status="uploading",s.progress=t.payload.progress)},fileCompleted:(e,t)=>{let s=e.files.find(e=>e.id===t.payload.id);s&&(s.status="success",s.error=void 0,s.url=t.payload.url,s.previewUrl=void 0)},fileFailed:(e,t)=>{let{error:s,id:i,disableRetry:a}=t.payload,n=e.files.find(e=>e.id===i);n&&(n.status="error",n.error=s,n.progress=0,a&&(n.disableRetry=!0))},fileRetry:(e,t)=>{let{id:s}=t.payload,i=e.files.find(e=>e.id===s);i&&(i.status="uploading",i.error=void 0,i.progress=0)},filesCleared:e=>{e.files=[]},setInputValue:(e,t)=>{e.inputValue=t.payload},quoteMessage:(e,t)=>{e.quoteMessageId=t.payload},autoPreviewFile:(e,t)=>{e.autoPreviewFile=t.payload},setPreviewingFileUrl:(e,t)=>{e.previewingFileUrl=t.payload},setShowSharePopover:(e,t)=>{e.showSharePopover=t.payload},setEffort:(e,t)=>{e.effort=t.payload},setInputMode:(e,t)=>{e.inputMode=t.payload},setChatQuote:(e,t)=>{e.chatQuote=t.payload},setMicrophonePermission:(e,t)=>{e.microphonePermission=t.payload}},selectors:{files:e=>e.files,chatQuote:e=>e.chatQuote,filePreviewUrlMap:(0,a.Mz)(e=>e.files,e=>[...Object.values(e).entries()].reduce((e,t)=>{let[s,i]=t;return{...e,[s]:{previewUrl:i.previewUrl}}},{})),allCompleteFiles:(0,a.Mz)(e=>e.files,e=>!Object.values(e).some(e=>"success"!==e.status)),inputValue:e=>e.inputValue,autoPreviewFile:e=>e.autoPreviewFile,previewingFileUrl:e=>e.previewingFileUrl,showSharePopover:e=>e.showSharePopover,effort:e=>e.effort,inputMode:e=>e.inputMode,microphonePermission:e=>e.microphonePermission}})},34655:(e,t,s)=>{s.d(t,{C:()=>o});var i=s(17029),a=s(19208);let n="recommend",r=e=>{var t;let{group:s,isRecommend:i,tag:a}=e;return i?n:null!==(t=null!=a?a:s)&&void 0!==t?t:""},o=(0,i.Z0)({name:"community",initialState:{dataSource:[],isDataSourceLoading:!1,groupedTotalMap:{},groupedIds:{}},reducers:{setDataSource:(e,t)=>{var s;let{list:i,filterOptions:a}=t.payload;e.dataSource=e.dataSource.flatMap(e=>i.find(t=>e.recordUid===t.recordUid)?[]:[e]);let n=r(a);e.dataSource.push(...i);let o=null!==(s=e.groupedIds[n])&&void 0!==s?s:[];e.groupedIds[n]=Array.from(new Set(o.concat(i.map(e=>e.recordUid))))},setRecommendationData:(e,t)=>{e.dataSource=e.dataSource.flatMap(e=>t.payload.find(t=>e.recordUid===t.recordUid)?[]:[e]),e.dataSource.push(...t.payload),e.groupedIds[n]=t.payload.map(e=>e.recordUid)},setFavorite:(e,t)=>{let{recordUid:s,isFavorite:i}=t.payload,a=e.dataSource.find(e=>e.recordUid===s);a&&(a.likeCount||(a.likeCount=0),i?a.likeCount+=1:a.likeCount-=1)},setIsDataSourceLoading:(e,t)=>{e.isDataSourceLoading=t.payload},setGroupedTotal:(e,t)=>{let s=r(t.payload.filterOptions);e.groupedTotalMap[s]=t.payload.total}},selectors:{dataSource:e=>e.dataSource,selectDataSourceByGroup:(0,a.Mz)([e=>e.dataSource,e=>e.groupedIds,(e,t)=>t],(e,t,s)=>{var i;return(null!==(i=t[r(s)])&&void 0!==i?i:[]).flatMap(t=>{let s=e.find(e=>e.recordUid===t);return s?[s]:[]})}),selectTotal:(0,a.Mz)([e=>e.groupedTotalMap,(e,t)=>t],(e,t)=>e[t]),isDataSourceLoading:e=>e.isDataSourceLoading,groupedTotalMap:e=>e.groupedTotalMap}})},87963:(e,t,s)=>{s.d(t,{e:()=>l});var i=s(16834),a=s(26865),n=s(17029),r=s(59413);let o={sessionListPinned:!0,agentWorkspaceAutoExpanded:!0,automaticallyLearnKnowledge:!0,theme:"system",clientId:(0,a.vd)(),browserNotificationShowed:!1,gotoComputerTipsShowed:!1,firstMessageTipsShowedV2:!1,disableContextExpensiveErrorSessions:[],invitationCodeLength:0},l=(0,n.Z0)({name:"configs",initialState:o,reducers:{setSessionListPinned:(e,t)=>{e.sessionListPinned=t.payload,t.payload?r.A.remove(i.eu.sessionListUnpinned):r.A.set(i.eu.sessionListUnpinned,"1",{expires:365})},setAgentWorkspaceAutoExpanded:(e,t)=>{e.agentWorkspaceAutoExpanded=t.payload},setAutomaticallyLearnKnowledge:(e,t)=>{e.automaticallyLearnKnowledge=t.payload},setTheme:(e,t)=>{e.theme=t.payload},setBrowserNotificationShowed:(e,t)=>{e.browserNotificationShowed=t.payload},setGotoComputerTipsShowed:(e,t)=>{e.gotoComputerTipsShowed=t.payload},setFirstMessageTipsShowed:(e,t)=>{e.firstMessageTipsShowedV2=t.payload},setDisableContextExpensiveErrorSessions:(e,t)=>{e.disableContextExpensiveErrorSessions=t.payload},setInvitationCodeLength:(e,t)=>{e.invitationCodeLength=t.payload}},selectors:{sessionListPinned:e=>e.sessionListPinned,agentWorkspaceAutoExpanded:e=>e.agentWorkspaceAutoExpanded,automaticallyLearnKnowledge:e=>e.automaticallyLearnKnowledge,theme:e=>e.theme,browserNotificationShowed:e=>e.browserNotificationShowed,gotoComputerTipsShowed:e=>e.gotoComputerTipsShowed,firstMessageTipsShowed:e=>e.firstMessageTipsShowedV2,disableContextExpensiveErrorSessions:e=>e.disableContextExpensiveErrorSessions,invitationCodeLength:e=>e.invitationCodeLength}})},60537:(e,t,s)=>{s.d(t,{h:()=>n});var i=s(17029),a=s(19208);let n=(0,i.Z0)({name:"connectors",initialState:{connectorApps:[]},reducers:{setConnectors:(e,t)=>{e.connectorApps=t.payload},disconnectApp:(e,t)=>{e.connectorApps=e.connectorApps.map(e=>e.type===t.payload?{...e,connected:!1,connectInfo:void 0}:e)}},selectors:{googleDriceConnector:(0,a.Mz)(e=>e.connectorApps,e=>e.find(e=>"google_drive"===e.type)),connectors:e=>e.connectorApps}})},67887:(e,t,s)=>{s.d(t,{K:()=>c,m:()=>m});var i=s(18214),a=s(26865),n=s(89902),r=s(17029),o=s(19208),l=s(87124),d=s(79544);let c=(0,r.Z0)({name:"fileManagement",initialState:{spaces:[],fileTab:"all",isDownloadMode:!1,selectedFiles:[],showGoogleDrivePicker:!1,googleDrivePickerOptions:null},reducers:{setSpaces:(e,t)=>{e.spaces=t.payload},updateSpace:(e,t)=>{if(!t.payload.spaceUid)return;let s=e.spaces.findIndex(e=>e.spaceUid===t.payload.spaceUid);if(-1===s){let s={...t.payload,title:t.payload.title||"",spaceUid:t.payload.spaceUid||"",status:t.payload.status||n.NP.VISIBLE,$typeName:"space.v1.SpaceStatusInfo",spaceUrl:t.payload.spaceUrl||"",publishedToCommunity:t.payload.publishedToCommunity||!1,sessionUid:t.payload.sessionUid||"",eventUid:t.payload.eventUid||""};e.spaces=[...e.spaces,s]}else e.spaces[s]=(0,l.A)(e.spaces[s],t.payload)},setFileTab:(e,t)=>{e.fileTab=t.payload},setDownloadMode:(e,t)=>{e.isDownloadMode=t.payload},setSelectedFiles:(e,t)=>{e.selectedFiles=t.payload},resetFileManagementDialog:e=>{e.fileTab="all",e.isDownloadMode=!1,e.selectedFiles=[]},openGoogleDrivePicker:(e,t)=>{e.showGoogleDrivePicker=!0,e.googleDrivePickerOptions=t.payload},closeGoogleDrivePicker:e=>{e.showGoogleDrivePicker=!1,e.googleDrivePickerOptions=null}},selectors:{spaces:e=>e.spaces,fileTab:e=>e.fileTab,isDownloadMode:e=>e.isDownloadMode,selectedFiles:e=>e.selectedFiles}}),p=(0,o.Mz)(e=>e.websocket.entities,e=>e.websocket.ids,(e,t)=>{let s=t.map(t=>e[t]);return d.$.extractFilesFromMessages(s)}),u=(0,o.Mz)(p,e=>e.fileManagement.fileTab,(e,t)=>{let s={today:[],yesterday:[],earlier:[]};e.flatMap(e=>{if("code"===t){if((0,a.KJ)(e.filetype))return[e]}else if("image"===t){if((0,a.u)(e.filetype))return[e]}else if("document"===t){if((0,a.As)(e.filetype))return[e]}else if("link"===t){if("link"===e.filetype)return[e]}else if("all"===t)return[e];return[]}).forEach(e=>{let t=new Date(e.timestamp);i.F.isToday(t)?s.today.push(e):i.F.isYesterday(t)?s.yesterday.push(e):s.earlier.push(e)}),Object.values(s).forEach(e=>{e.sort((e,t)=>t.timestamp-e.timestamp)});let n=s.today.length+s.yesterday.length+s.earlier.length;return{groups:s,length:n}}),g=(0,o.Mz)(u,e=>{let t={today:[...e.groups.today],yesterday:[...e.groups.yesterday],earlier:[...e.groups.earlier]};t.today=t.today.filter(e=>!(0,a.n4)(e.filetype)),t.yesterday=t.yesterday.filter(e=>!(0,a.n4)(e.filetype)),t.earlier=t.earlier.filter(e=>!(0,a.n4)(e.filetype));let s=t.today.length+t.yesterday.length+t.earlier.length;return{groups:t,length:s}}),m={files:p,selectGroupedFiles:u,downloadableFiles:g,chatAttachments:(0,o.Mz)(e=>e.websocket.entities,e=>e.websocket.ids,(e,t)=>{let s=t.map(t=>e[t]).flatMap(e=>"event"===e.type&&"chat"===e.event.type&&"assistant"===e.event.sender?[e.event]:[]),i={};return s.forEach(e=>{d.$.extractFileFromChat(e,i)}),Object.values(i)})}},79544:(e,t,s)=>{s.d(t,{$:()=>o});var i=s(12766),a=s(26865),n=s(57271);class r{getDisplayFilename(e){if(!e)return"";let t=e.split(".");if(t.length>0){let e=t[t.length-1];return("md"===e||"mdx"===e)&&t.pop(),t.join(".")}return e}mergeFilenameWithExt(e,t){if("unknown"===t)return e;let s=e.split(".");return s.length>1||(t.startsWith(".")?s.push(t.slice(1)):s.push(t)),s.join(".")}getFileName(e){return e.split(/\/|\\/).pop()||e}getFileExt(e){return e.split(".").pop()||""}extractFilesFromMessages(e){let t={};return e.forEach(e=>{if("event"===e.type){let s=e.event;"toolUsed"===s.type?this.extractFileFromToolUsed(s,t):"chat"===s.type?this.extractFileFromChat(s,t):"contextTransferResult"===s.type&&this.extractFileFromContextTransferResult(s,t)}}),e.flatMap(e=>"event"===e.type&&"deploySuccess"===e.event.type?[e.event]:[]).forEach(e=>{if(!e.deployUrl)return;let s=e.deployUrl;t[s]&&(t[s].deployEventId=e.id)}),Object.values(t)}extractFileFromToolUsed(e,t){var s,i;if("media_viewer"===e.tool&&(null===(s=e.detail)||void 0===s?void 0:s.mediaViewer)){let{filePath:s,fileUrl:i,type:a}=e.detail.mediaViewer;if("image"===a){let a=this.getFileName(s);t[s]={id:s,type:"server",eventId:e.id,filename:a,timestamp:e.timestamp,filetype:this.getFileExt(a),url:i}}}else if("text_editor"===e.tool&&(null===(i=e.detail)||void 0===i?void 0:i.textEditor)){let{path:s,content:i}=e.detail.textEditor;if(s&&i){let a=this.getFileName(s);t[s]={id:s,type:"local",eventId:e.id,filename:this.getFileName(a),timestamp:e.timestamp,fileContent:i,filetype:this.getFileExt(a)}}}}extractFileFromChat(e,t){"user"===e.sender?e.attachments.forEach(s=>{"voice"!==s.type&&(t[s.id]={id:s.id,eventId:e.id,timestamp:e.timestamp,type:"server",url:s.url,filename:s.filename,filetype:"file"===s.type?this.getFileExt(s.filename):s.type,extra:s.extra})}):"assistant"===e.sender&&(e.attachments.forEach(s=>{let i=s.path||s.url||"";i&&s.url&&(t[i]={id:i,eventId:e.id,timestamp:e.timestamp,type:"server",url:s.url,filetype:"file"===s.type?this.getFileExt(s.filename):s.type,filename:this.getFileName(s.filename),title:s.title})}),e.linkMetaMap&&Object.values(e.linkMetaMap).forEach(s=>{if(!s.url)return;let i=s.url;t[i]={id:i,type:"server",eventId:e.id,filename:s.title,timestamp:e.timestamp,filetype:"link",url:s.url}}))}extractFileFromContextTransferResult(e,t){"contextTransferResult"===e.type&&e.allOldFiles.forEach(s=>{if(s.url){let i=s.id;t[i]={eventId:e.id,timestamp:e.timestamp,id:i,type:"server",url:s.url,filename:this.getFileName(s.filename),filetype:s.filetype,extra:s.extra}}if(s.fileContent){let i=s.id;t[i]={eventId:e.id,timestamp:e.timestamp,id:i,type:"local",fileContent:s.fileContent,filename:this.getFileName(s.filename),filetype:s.filetype}}})}getSpaceId(e){try{return new URL(e).host.split(".")[0]||""}catch(e){return console.error("get space id  error",e),""}}getLinkType(e){try{if(!e)return"other";let t=new URL(e);if(t.hostname===i.a.pageDomain)return"page";if(i.a.deployDomain&&t.origin.endsWith(i.a.deployDomain))return"space";if(i.a.sandboxDomain&&t.origin.endsWith(i.a.sandboxDomain)||t.origin.endsWith("manusvm.computer"))return"sandbox";return"other"}catch(e){return console.error("get link type error",e),"other"}}extractDomainPrefix(e){if(!e||"string"!=typeof e)return"";let t=e.trim();return(t=t.replace(/^(https?:\/\/)?(www\.)?/i,"")).includes(".")?t.split(".")[0]||"":t}validateSubdomain(e){return e.length<3?{valid:!1,message:n.I.t("The subdomain must be at least 3 characters long.")}:e.length>63?{valid:!1,message:n.I.t("The subdomain must not exceed 63 characters.")}:e.includes("--")?{valid:!1,message:n.I.t("The subdomain cannot contain consecutive hyphens.")}:/^[a-z0-9][a-z0-9-]*[a-z0-9]$/.test(e)?{valid:!0}:{valid:!1,message:n.I.t("The subdomain can only contain lowercase letters, numbers, and hyphens, and must start and end with a letter or number.")}}replaceFirstSubdomain(e,t){try{let s=new URL(e),i=s.hostname.split(".");if(i.length>=2){i[0]=t;let e=i.join(".");return s.hostname=e,s.toString()}return e}catch(t){return console.error("Invalid URL:",t),e}}getDownloadFilename(e,t){if(e.includes("."))return e;let s=(0,a.vE)(t);return"".concat(e,".").concat(s)}downloadFileWithALink(e,t){let s=document.createElement("a");s.href=e,s.target="_blank",s.download=t,s.click(),window.URL.revokeObjectURL(e)}async getDownloadBlobUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s="";try{let i=await fetch(e,{method:"HEAD"}),a=i.headers.get("content-disposition"),n=i.headers.get("content-type"),r=a&&a.includes("attachment")||"application/octet-stream"===n,o=i.headers.get("content-length");if((o?parseInt(o,10):0)<1048576*t&&!r){let t=await fetch(e),i=await t.blob();s=e=URL.createObjectURL(i)}}catch(e){console.error(e)}return s}}let o=new r},77883:(e,t,s)=>{s.d(t,{P:()=>i});let i=(0,s(17029).Z0)({name:"knowledge",initialState:{userKnowledgeListLoading:!1,suggestedKnowledgeMap:{},userKnowledgeList:[],userKnowledgeTotal:0},reducers:{setUserKnowledgeListLoading:(e,t)=>{e.userKnowledgeListLoading=t.payload},setSuggestedKnowledgeList:(e,t)=>{let s=t.payload;if(0===s.length)return;let i=s[0].sessionUid;e.suggestedKnowledgeMap[i]=s},setUserKnowledgeList:(e,t)=>{e.userKnowledgeList=t.payload},createUserKnowledge:(e,t)=>{e.userKnowledgeList=[t.payload,...e.userKnowledgeList],e.userKnowledgeTotal+=1},updateUserKnowledge:(e,t)=>{e.userKnowledgeList=e.userKnowledgeList.map(e=>e.uid===t.payload.uid?t.payload:e)},deleteUserKnowledge:(e,t)=>{e.userKnowledgeList=e.userKnowledgeList.filter(e=>e.uid!==t.payload.knowledgeUid),e.userKnowledgeTotal-=1},setUserKnowledgeTotal:(e,t)=>{e.userKnowledgeTotal=t.payload},updateSuggestedKnowledge:(e,t)=>{let s=t.payload;if(!s)return;let i=s.sessionUid,a=(e.suggestedKnowledgeMap[i]||[]).map(e=>e.uid===s.uid?s:e);e.suggestedKnowledgeMap[i]=a}},selectors:{knowledgeListLoading:e=>e.userKnowledgeListLoading,userKnowledgeList:e=>e.userKnowledgeList,userKnowledgeTotal:e=>e.userKnowledgeTotal,suggestedKnowledgeMap:e=>e.suggestedKnowledgeMap}})},4331:(e,t,s)=>{s.d(t,{y:()=>i});let i=(0,s(17029).Z0)({name:"notification",initialState:{connectStatus:"default",connectError:null,isNotificationListVisible:!1,notificationList:[],fetchNotificationLoading:!1,hasNew:!1,hasMoreNotification:!0},reducers:{setConnectStatus(e,t){e.connectStatus=t.payload},setConnectError(e,t){e.connectError=t.payload},setHasMoreNotification(e,t){e.hasMoreNotification=t.payload},setIsNotificationListVisible:(e,t)=>{e.isNotificationListVisible=t.payload},setNotificationList(e,t){e.notificationList=t.payload},setFetchNotificationListLoading(e,t){e.fetchNotificationLoading=t.payload},setHasNew(e,t){e.hasNew=t.payload}},selectors:{connectStatus:e=>e.connectStatus,connectError:e=>e.connectError,hasMoreNotification:e=>e.hasMoreNotification,isNotificationListVisible:e=>e.isNotificationListVisible,notificationList:e=>e.notificationList,fetchNotificationLoading:e=>e.fetchNotificationLoading,hasNew:e=>e.hasNew}})},92099:(e,t,s)=>{s.d(t,{$:()=>i});let i=(0,s(17029).Z0)({name:"sessionSwitch",initialState:{keyword:"",sessions:[]},reducers:{setKeyword:(e,t)=>{e.keyword=t.payload},setSessions:(e,t)=>{e.sessions=t.payload}},selectors:{keyword:e=>e.keyword,sessions:e=>e.sessions}})},25087:(e,t,s)=>{s.d(t,{L:()=>l,u:()=>c});var i=s(18214),a=s(88359),n=s(17029),r=s(19208);let o=(e,t)=>{let s=e.lastMessageTime||e.createdAt,a=t.lastMessageTime||t.createdAt,n=0,r=0;return s&&(n=i.F.protoTimestampToDate(s).getTime()),a&&(r=i.F.protoTimestampToDate(a).getTime()),r-n},l=(0,n.pU)({selectId:e=>e.uid}),d={currentSessionId:null,searchValue:"",isSearchMode:!1,sessions:l.getInitialState(),loadSessionLoading:!1,isShareMode:!1,sessionListIds:[]},c=(0,n.Z0)({name:"sessions",initialState:d,reducers:{setLoadSessionLoading(e,t){e.loadSessionLoading=t.payload},setCurrentSessionId(e,t){e.currentSessionId=t.payload},setSearchValue(e,t){e.searchValue=t.payload},setIsSearchMode(e,t){e.isSearchMode=t.payload},setIsShareMode(e,t){e.isShareMode=t.payload},setSessions(e,t){l.setMany(e.sessions,t.payload)},setSessionListIds(e,t){e.sessionListIds=t.payload,a._.setItem("sessionsSize",e.sessionListIds.length)},upsertSession(e,t){e.sessionListIds.includes(t.payload.uid)||(e.sessionListIds=[t.payload.uid,...e.sessionListIds],a._.setItem("sessionsSize",e.sessionListIds.length)),l.upsertOne(e.sessions,t.payload)},toggleSessionFavorite(e,t){l.updateOne(e.sessions,{id:t.payload.uid,changes:{isFavorite:t.payload.isFavorite}}),t.payload.isFavorite?e.sessionListIds=e.sessionListIds.filter(e=>e!==t.payload.uid):e.sessionListIds.includes(t.payload.uid)||(e.sessionListIds=[t.payload.uid,...e.sessionListIds])},setSessionTitle(e,t){l.updateOne(e.sessions,{id:t.payload.sessionId,changes:{title:t.payload.title}})},shareSession(e,t){var s;l.updateOne(e.sessions,{id:t.payload.sessionId,changes:{isShared:null!==(s=t.payload.isShared)&&void 0!==s&&s}})},deleteSessions(e,t){l.removeOne(e.sessions,t.payload.sessionId),e.sessionListIds=e.sessionListIds.filter(e=>e!==t.payload.sessionId),a._.setItem("sessionsSize",e.sessionListIds.length),t.payload.sessionId===e.currentSessionId&&(e.currentSessionId=null)},handleSessionNewMessageEvent(e,t){let{payload:s}=t,i={...s.lastDisplayMessage&&{lastDisplayMessage:s.lastDisplayMessage},...s.lastMessageTime&&{lastMessageTime:s.lastMessageTime},...void 0!==s.unreadMessageCount&&{unreadMessageCount:s.sessionUid===e.currentSessionId?0:s.unreadMessageCount},...void 0!==s.newMessageCount&&{newMessageCount:s.newMessageCount},...void 0!==s.status&&{status:s.status}};l.updateOne(e.sessions,{id:s.sessionUid,changes:i})},handleSessionTitleEvent(e,t){let{payload:s}=t;l.updateOne(e.sessions,{id:s.sessionUid,changes:{title:s.title,icon:s.icon,iconInfo:s.iconInfo}})},handleSessionCostedCreditsEvent(e,t){let{payload:s}=t;l.updateOne(e.sessions,{id:s.sessionUid,changes:{costedCredits:s.costedCredits}})},clearUnreadMessageCount(e,t){l.updateOne(e.sessions,{id:t.payload,changes:{unreadMessageCount:0}})},setIsSharePopoverVisible(e,t){e.isSharePopoverVisible=t.payload},setKnowledgeTipsVisibleScene:(e,t)=>{e.knowledgeTipsVisibleScene=t.payload}},selectors:{currentSessionid:e=>e.currentSessionId,currentSession:(0,r.Mz)(e=>e.currentSessionId,e=>e.sessions,(e,t)=>e?l.getSelectors().selectById(t,e):null),searchValue:e=>e.searchValue,isSearchMode:e=>e.isSearchMode,sessions:(0,r.Mz)([e=>e.sessions,e=>e.sessionListIds],(e,t)=>t.flatMap(t=>{let s=l.getSelectors().selectById(e,t);return s&&!s.isFavorite?[s]:[]}).sort(o)),getSession:(0,r.Mz)([e=>e.sessions,(e,t)=>t],(e,t)=>t?l.getSelectors().selectById(e,t):null),loadSessionLoading:e=>e.loadSessionLoading,isShareMode:e=>e.isShareMode,favoriteSessions:(0,r.Mz)([e=>e.sessions],e=>l.getSelectors().selectAll(e).filter(e=>e.isFavorite).sort(o)),isSharePopoverVisible:e=>e.isSharePopoverVisible,sessionListIds:e=>e.sessionListIds,knowledgeTipsVisibleScene:e=>e.knowledgeTipsVisibleScene}})},44238:(e,t,s)=>{s.d(t,{Z:()=>i});let i=(0,s(17029).pU)({selectId:e=>e.id,sortComparer:(e,t)=>e.timestamp-t.timestamp})},17240:(e,t,s)=>{s.d(t,{U8:()=>a,jh:()=>o,ru:()=>n,wD:()=>r});var i=s(26865);function a(e,t){var s,i,a;if(0===e.length)return{start:0,end:0,currentTimestamp:0,prevPercentage:0,nextPercentage:100};let n=e[0].ts,r=e[e.length-1].ts,o=r-n;if(0===t)return{start:n,end:r,currentTimestamp:n,prevPercentage:0,nextPercentage:1===e.length?100:((null!==(i=null===(s=e[1])||void 0===s?void 0:s.ts)&&void 0!==i?i:r)-n)/o*100};if(100===t){let t=e[e.length-2];return{start:n,end:r,currentTimestamp:r,prevPercentage:t?(t.ts-n)/o*100:0,nextPercentage:100}}let l=n+o*t/100,d=e.findIndex(e=>e.ts>=l);-1===d?d=e.length-1:d>0&&((null===(a=e[d])||void 0===a?void 0:a.ts)===l||Math.abs(e[d-1].ts-l)<Math.abs(e[d].ts-l)&&d--);let c=d-1;for(;c>=0&&e[c].ts===e[d].ts;)c--;let p=c>=0?e[c].ts:n,u=d+1;for(;u<e.length&&e[u].ts===e[d].ts;)u++;let g=u<e.length?e[u].ts:r;return{start:n,end:r,currentTimestamp:l,prevPercentage:(p-n)/o*100,nextPercentage:(g-n)/o*100}}function n(e,t,s){if(0===s.length)return[];let i=[];return t.forEach(t=>{let{id:s}=t,a=e[s];a&&i.push({ts:a.timestamp,id:s})}),i.sort((e,t)=>e.ts-t.ts)}function r(e,t,s){let a=t.flatMap(t=>e[t]?[e[t]]:[]).sort((e,t)=>e.timestamp-t.timestamp).filter(e=>"event"===e.type&&i.yF.isEventInScope(e.event,"timeline"));if(0===a.length)return"";let n=a[0].timestamp,r=n+(a[a.length-1].timestamp-n)*s/100,o="",l=Number.MAX_VALUE;for(let e=0;e<a.length;e++){let t=a[e],s=t.timestamp-r,i=Math.abs(s);if(i<l)l=i,o=t.id;else if(s>0)break}return o}function o(e,t){if(0===e.length)return 0;let s=e[0].ts,i=e[e.length-1].ts;return t<=s?0:t>=i?100:(t-s)/(i-s)*100}},85799:(e,t,s)=>{s.d(t,{r:()=>E,M:()=>T});var i=s(9205),a=s(26865),n=s(17029),r=s(57271),o=s(92264),l=s(44238),d=s(17240),c=s(19208);let p=(0,c.Ad)({memoize:c.i5,memoizeOptions:{equalityCheck:(e,t)=>!("object"!=typeof e||null===e||Array.isArray(e)||"object"!=typeof t||null===t||Array.isArray(t))||e===t}});function u(e){return(0,c.Mz)(e=>e.entities,t=>t.scopeEvents[e],(t,s)=>s.map(e=>{let{id:s}=e,i=t[s];return(null==i?void 0:i.type)==="event"?i.event:null}).filter(t=>!!t&&a.yF.isEventInScope(t,e)))}let g=u("chatBox"),m=u("sandbox"),f=(0,c.Mz)(e=>e.entities,e=>e.ids,(e,t)=>t.map(t=>e[t]).filter(e=>void 0!==e).sort((e,t)=>e.timestamp-t.timestamp)),y=(0,c.Mz)(f,e=>e.flatMap(e=>"event"===e.type?[e.event]:[])),h=(0,c.Mz)(e=>e.entities,e=>e.scopeEvents.timeline,e=>e.ids,(e,t,s)=>(0,d.ru)(e,t,s)),v=(0,c.Mz)(e=>e.entities,e=>e.ids,e=>e.timelinePercentage,(e,t,s)=>(0,d.wD)(e,t,s)),b=(0,c.Mz)(h,e=>e.timelinePercentage,d.U8),S=(0,c.Mz)(f,e=>{let t=e.flatMap(e=>"event"===e.type&&a.yF.isEventInScope(e.event,"planner")?[e.event]:[]),s=t.findLast(e=>"planUpdate"===e.type);return{statusUpdate:t.findLast(e=>"statusUpdate"===e.type),planUpdate:s}}),w=(0,c.Mz)(f,e=>{for(let t=e.length-1;t>=0;t--){let s=e[t];if("event"===s.type&&"liveStatus"===s.event.type)return s.event.text}return null}),L=(e,t,s)=>{if(0===s.length||!s.some(e=>e.id===t))return null;let i=e[t];if((null==i?void 0:i.type)!=="event")return null;let{event:a}=i;if("toolUsed"===a.type){let e;if("error"===a.status)return"terminal"===a.tool?{brief:a.description,event:a,toolStatus:{tool:"terminal",errorMsg:a.description,feedback:a.feedback,terminals:{terminal_1:{name:"",history:[]}}}}:"browser"===a.tool?{brief:a.brief,event:a,toolStatus:{tool:"browser",url:"",screenshot:"",errorMsg:a.description,feedback:a.feedback},description:a.description}:"search"===a.tool?{brief:a.brief,event:a,toolStatus:{tool:"search",queries:[],results:[],errorMsg:a.description,feedback:a.feedback},description:a.description}:"text_editor"===a.tool?{brief:a.brief,event:a,toolStatus:{tool:"text_editor",files:{},errorMsg:a.description,feedback:a.feedback},description:a.description}:"media_viewer"===a.tool?{brief:a.brief,event:a,toolStatus:{tool:"media_viewer",filePath:"",fileUrl:"",errorMsg:a.description,feedback:a.feedback}}:null;if("success"!==a.status)return null;if("browser"===a.tool){let{screenshot:t,url:s}=a.detail.browser;e={tool:"browser",url:s,screenshot:t,feedback:a.feedback}}else if("search"===a.tool){let{queries:t,results:s}=a.detail.search;e={tool:"search",queries:t.flatMap(e=>e.split(" ")),results:s,feedback:a.feedback}}else if("terminal"===a.tool){let{shellId:t,output:s}=a.detail.terminal,i={};i[t]={name:t,history:s},e={tool:"terminal",terminals:i,feedback:a.feedback}}else if("text_editor"===a.tool){var n;let{path:t="result",content:s,oldContent:i,output:r}=a.detail.textEditor,o={};o[t]={type:r?"output":"file",path:t,content:null!==(n=null!=s?s:r)&&void 0!==n?n:"",oldContent:i},e={tool:"text_editor",files:o,feedback:a.feedback}}else{if("media_viewer"!==a.tool)return null;let{mediaViewer:e}=a.detail||{};return e?{brief:a.brief,event:a,toolStatus:{tool:"media_viewer",feedback:a.feedback,...e}}:null}return{brief:a.tool,event:a,description:a.description,toolStatus:e}}return"terminalUpdate"===a.type?{brief:a.brief,description:a.description,event:a,toolStatus:{tool:"terminal",terminals:{[a.shellId]:{name:a.shellId,history:[a.output]}}}}:null},I={selectSandbox:(0,c.Mz)(m,e=>e[e.length-1]||null),selectTimelineDetails:b,selectTimelinePoints:h,ids:e=>e.ids,selectTimelinePercentage:e=>e.timelinePercentage,selectCurrentTimelineId:v,selectMessageById:(e,t)=>e.entities[t],isConnected:e=>"connected"===e.status,error:e=>e.error,selectDeployConfirmStatus:(e,t)=>{let s=g(e).find(e=>"confirmDeploy"===e.type&&e.deployActionId===t);return s?s.accept?"confirmed":"declined":"pending"},lastDeployedSuccessEvent:(0,c.Mz)(f,e=>{let t=e.flatMap(e=>"event"===e.type&&"deploySuccess"===e.event.type?[e.event]:[]);return t[t.length-1]||null}),selectLastFrontendEventId:e=>e.frontendEventIds[e.frontendEventIds.length-1],chatBoxMessageIds:(0,c.Mz)(e=>e.scopeEvents.chatBox,e=>e.map(e=>e.id)),selectMessages:f,selectEvents:y,selectChatBoxMessages:(0,c.Mz)(g,e=>{let t=[],s=new Map,i=null,a=[];return e.forEach(e=>{switch(e.type){case"chat":t.push(e),i=null;return;case"knowledgeSuggested":case"resourceAccessed":i?i.children.push(e):t.push(e);return;case"newPlanStep":{let a={type:"stepGroup",event:e,children:[]};i=a,t.push(a),s.set(e.stepId,a);return}case"statusUpdate":case"toolUsed":{if("statusUpdate"===e.type&&(e.noRender||"stopped"===e.agentStatus||"waiting"===e.agentStatus))return;let s=!1,n=-1;for(let i=t.length-1;i>=0;i--){let a=t[i];if((null==a?void 0:a.type)==="stepGroup"&&a.event.stepId===e.planStepId){n=i;break}(null==a?void 0:a.type)==="chat"&&(s=!0)}if(-1!==n){let a=t[n];if("statusUpdate"===e.type&&!s&&a.children.some(t=>"statusUpdate"===t.type&&t.description===e.description))return;if(s){let s={...a,event:{...a.event,isContinue:!0},children:[]};s.children.push(e),t.push(s),i=s}else a.children.push(e)}else{let s=t[t.length-1];"statusUpdate"===e.type&&"error"===e.agentStatus?(null==s?void 0:s.type)==="chat"&&"assistant"===s.sender&&s.content||t.push(e):a.push(e)}return}case"queueStatusChange":"waiting"!==e.queueStatus&&t.push(e)}}),a.forEach(e=>{let t=s.get(e.planStepId);(null==t||!t.children.some(t=>"statusUpdate"===t.type&&t.description===e.description))&&t&&(t.children.push(e),t.children=t.children.sort((e,t)=>e.timestamp<t.timestamp?-1:e.timestamp>t.timestamp?1:0))}),t.flatMap(e=>"stepGroup"===e.type&&0===e.children.length?[]:[e])}),selectUserStopped:(0,c.Mz)(f,e=>{let t=e.findLastIndex(e=>"event"===e.type&&"chat"===e.event.type);return e.findLastIndex(e=>"event"===e.type&&"userStop"===e.event.type)>t}),liveStatus:w,plannerStatus:S,followAgentStatus:p(e=>e.entities,v,e=>e.scopeEvents.timeline,(e,t,s)=>L(e,t,s)),lastFollowAgentStatus:(0,c.Mz)(e=>e.entities,e=>e.scopeEvents.timeline,(e,t)=>{let s=t[t.length-1];return s?L(e,s.id,t):null}),showHomeView:(0,c.Mz)(e=>e.scopeEvents.chatBox,e=>0===e.length),isSandBoxError:(0,c.Mz)(f,e=>e.scopeEvents.sandbox,(e,t)=>{if(0===t.length)return!1;let s=e.findLast(e=>"event"===e.type&&a.yF.isEventInScope(e.event,"sandbox"));return s?!!s&&"event"===s.type&&"sandboxUpdate"===s.event.type&&"error"===s.event.status:null}),queue:(0,c.Mz)(f,e=>{let t=e.flatMap(e=>"event"===e.type&&"queueStatusChange"===e.event.type?[e.event]:[]);return t[t.length-1]||null}),isContextTransferMessage:(0,c.Mz)(f,e=>e.slice(0,10).some(e=>"event"===e.type&&"contextTransferFlag"===e.event.type)),contextTransferredStatus:(0,c.Mz)(y,e=>{let t=e.find(e=>"contextTransferResult"===e.type);return t?t.disableUserInput?"failed":"success":"transferring"}),contextTransferResult:(0,c.Mz)(y,e=>e.findLast(e=>"contextTransferResult"===e.type)),taskFinished:e=>e.taskFinished,linkMetaMap:(0,c.Mz)(y,e=>{let t={};return e.forEach(e=>{"chat"===e.type&&"assistant"===e.sender&&e.linkMetaMap&&(t={...t,...e.linkMetaMap})}),t}),isRefundableQuota:(0,c.Mz)(y,e=>!!e.findLast(e=>{var t;return"quotaRefunded"===e.type&&!(null===(t=e.error)||void 0===t?void 0:t.length)})),tryItYourselfData:(0,c.Mz)(f,e=>{let t=e.findIndex(e=>"event"===e.type&&"makeYourVersionResult"===e.event.type),s=e.findIndex(e=>{var t;return"event"===e.type&&"chat"===e.event.type&&"user"===e.event.sender&&(null===(t=e.event.extData)||void 0===t?void 0:t.from)==="make-your-version"}),i=!1,a=null;if(-1!==t){let s=e[t];if(s&&"event"===s.type){a=s.event;for(let s=t;s<e.length;s++){let t=e[s];(null==t?void 0:t.type)==="event"&&"chat"===t.event.type&&"user"===t.event.sender&&(i=!0)}}}return{disabled:-1!==s&&!i,visibleCard:-1!==s&&!i&&(null==a?void 0:a.success),event:a}})},M=()=>({status:"disconnected",error:null,contextLengthStatus:"normal",frontendEventIds:[],scopeEvents:{browser:[],timeline:[],chatBox:[],textEditor:[],sandbox:[],terminal:[],planner:[],eventStream:[]},timelinePercentage:100,taskFinished:!0}),x=()=>l.Z.getInitialState(M());function E(e,t){var s;return{type:"event",timestamp:null!==(s=t.timestamp)&&void 0!==s?s:Date.now(),event:t,messageStatus:"confirmed",id:t.id,sessionId:e}}function C(e,t){return"force"===e?"force":t.mode}let T=(0,n.Z0)({name:"websocket",initialState:x(),reducers:{disconnected:(e,t)=>{var s,i;e.status="disconnected",e.error=null!==(i=null===(s=t.payload.error)||void 0===s?void 0:s.message)&&void 0!==i?i:"Connection failed"},connected:e=>{e.status="connected",e.error=null},connecting:e=>{e.status="connecting",e.error=null},missingEventsReceived:(e,t)=>{let{afterId:s,events:i}=t.payload,n=e.entities[s];if(n)for(let t of i){var r;for(let s of(e.entities[t.id]&&(null===(r=e.entities[t.id])||void 0===r?void 0:r.messageStatus)!=="pending"||("contextTooLong"===t.type&&(e.contextLengthStatus=C(e.contextLengthStatus,t)),l.Z.upsertOne(e,{type:"event",timestamp:t.timestamp,id:t.id,sessionId:n.sessionId,messageStatus:"confirmed",event:t})),a.yF.getEventScopes(t.type)))-1===e.scopeEvents[s].findIndex(e=>e.id===t.id)&&e.scopeEvents[s].push({id:t.id})}},deleteMessageById:(e,t)=>{l.Z.removeOne(e,t.payload.messageId)},messageSentTimeout:(e,t)=>{let s=e.entities[t.payload.messageId];s&&"confirmed"!==s.messageStatus&&l.Z.updateOne(e,{id:t.payload.messageId,changes:{messageStatus:"failed",errorMsg:r.I.t("Request Timeout")}})},received:(e,t)=>{let s=e.entities[t.payload.id];if(s&&"confirmed"===s.messageStatus){console.warn("BUG: Event already exists",t.payload);return}if("agent_error"===t.payload.type&&(console.error("Agent error:",t.payload),404!==t.payload.code&&(0,i.oR)({variant:"error",title:r.I.t("Manus Agent Error: ")+t.payload.message})),"event"!==t.payload.type){l.Z.addOne(e,{...t.payload,messageStatus:t.payload.messageStatus||"confirmed"});return}let n=t.payload.event;"contextTooLong"===n.type&&(e.contextLengthStatus=C(e.contextLengthStatus,n));let o=n.type,c=n.id;if((0,a.Bl)(n)){let s=e.entities[n.targetEventId],i="";if(s&&"event"===s.type){var p;i=null!==(p=s.event.content)&&void 0!==p?p:""}c=n.targetEventId,o="chat",l.Z.upsertOne(e,{type:"event",timestamp:n.timestamp,id:c,sessionId:t.payload.sessionId,messageStatus:"pending",event:{type:"chat",messageType:"text",id:c,content:i+n.delta.content,attachments:[],timestamp:n.timestamp,sender:n.sender}})}else e.frontendEventIds.push(t.payload.id),l.Z.upsertOne(e,{...t.payload,messageStatus:t.payload.messageStatus||"confirmed"});let u=a.yF.getEventScopes(o),g=null;if(u.includes("timeline")&&100!==e.timelinePercentage){let t=e.scopeEvents.timeline,s=(0,d.ru)(e.entities,t,e.ids);if(s.length>0){let{currentTimestamp:t}=(0,d.U8)(s,e.timelinePercentage);g=t}}for(let t of u)-1===e.scopeEvents[t].findLastIndex(e=>e.id===c)&&e.scopeEvents[t].push({id:c});if(g){let t=e.scopeEvents.timeline,s=(0,d.ru)(e.entities,t,e.ids);e.timelinePercentage=(0,d.jh)(s,g)}},initEvents:(e,t)=>{let{sessionId:s,events:i}=t.payload,n=i.map(e=>E(s,e)),r=l.Z.setAll(l.Z.getInitialState({...M(),status:e.status}),n);return r.frontendEventIds=l.Z.getSelectors().selectIds(r),l.Z.getSelectors().selectAll(r).forEach(e=>{if("event"===e.type)for(let t of("contextTooLong"===e.event.type&&(r.contextLengthStatus=C(r.contextLengthStatus,e.event)),a.yF.getEventScopes(e.event.type)))r.scopeEvents[t].push({id:e.id})}),r},clearEvents:e=>({...x(),status:e.status}),errored:(e,t)=>{e.error=t.payload},timelineChanged:(e,t)=>{e.timelinePercentage=t.payload},setTaskFinished:(e,t)=>{e.taskFinished=t.payload}},extraReducers:e=>{e.addCase(o.r2,(e,t)=>{let s=null==t?void 0:t.payload;return s&&s.websocket?{...s.websocket,status:"disconnected"}:e})},selectors:I})}}]);
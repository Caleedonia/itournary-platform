"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27846],{98637:(e,t,i)=>{i.d(t,{x:()=>o});var s=i(99515),n=i(75958),a=i(94794);function o(e,t,i){let o=(0,n.w)(e);return(0,s.useMemo)(()=>(0,a.A)(function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return o(...t)},t,i),[])}},97603:(e,t,i)=>{i.d(t,{K:()=>p,d:()=>c});var s=i(49341),n=i(47059),a=i(18952),o=i(12766),r=i(29298),l=i(36076),c=function(e){return e.Plan="plan",e}({});let d={[r.b.Free]:l.A.VipVersionForTrack.free,[r.b.Pro]:l.A.VipVersionForTrack.pro,[r.b.Casual]:l.A.VipVersionForTrack.starter};class u{static createPageViewTrackingEnrichment(){return{name:"page-view-tracking-enrichment",type:"enrichment",setup:async()=>void 0,execute:async e=>{if(e.event_properties)for(let t of u.PROPERTIES_TO_REMOVE)delete e.event_properties[t];return e}}}init(){!this.inited&&o.a.amplitudeKey&&(this.inited=!0,(0,s.WQ)(u.createPageViewTrackingEnrichment()),(0,s.Ts)(o.a.amplitudeKey,{transport:"beacon",autocapture:{elementInteractions:!0}}))}reset(){this.inited=!1,this.storageUserId=null,this.storageUserProperties={},(0,s.cL)()}setUserId(e){e&&this.storageUserId!==e&&(this.inited||this.init(),this.storageUserId=e,(0,s.do)(e))}trackOnce(e){this.inited||this.init(),(0,s.u4)(e)}batchTrack(e){for(let t of(this.inited||this.init(),e))(0,s.u4)(t)}customUserProperties(e){let t;if(!e||0===Object.keys(e).length)return;this.inited||this.init(),t=this.storageUserProperties?this.extractChangedValues(this.storageUserProperties,e):e,this.storageUserProperties=e;let i=new n.T$;Object.entries(t).forEach(e=>{let[t,s]=e;i.set(t,"number"==typeof s?"".concat(s):s)}),(0,s.ls)(i)}customUserPropertyOne(e,t){if(!e||(this.inited||this.init(),this.storageUserProperties[e]===t))return;this.storageUserProperties[e]=t;let i=new n.T$;i.set(e,t),(0,s.ls)(i)}extractChangedValues(e,t){let i={};return Object.keys(t).forEach(s=>{s in e&&e[s]===t[s]||(i[s]=t[s])}),i}formatToAmplitude(e){let{events:t,clientInfo:i,userInfo:s}=e;return(0,a.T)("server",t.map(e=>{let{eventName:t,extData:n}=e;return{event_type:t,event_properties:{ext_data:n,client_info:i,user_info:s}}}))}formatMemberShipToNumber(e){var t;return null!==(t=d[e])&&void 0!==t?t:l.A.VipVersionForTrack.unknown}constructor(){this.inited=!1,this.storageUserId=null,this.storageUserProperties={}}}u.PROPERTIES_TO_REMOVE=["page_title","[Amplitude] Page Title"];let p=new u},28921:(e,t,i)=>{i.d(t,{G:()=>o,Q:()=>r});var s=i(99515),n=i(91452),a=i(20900);let o={appStart:e=>{let{action:t}=e;n.M_.getState().auth.userInfo&&(0,a.C)({eventName:"app_start",extData:{sessionNum:n.M_.getState().sessions.sessions.ids.length,action:t}})},appStartFromLink:e=>{let{linkSource:t}=e;(0,a.C)({eventName:"app_start_from_link",extData:{linkSource:t}})}},r=()=>{(0,s.useEffect)(()=>{o.appStart({action:"onLoad"});let e=()=>{"visible"===document.visibilityState&&o.appStart({action:"onVisible"})};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[])}},75297:(e,t,i)=>{i.d(t,{Q:()=>o});var s=i(91452),n=i(21731),a=i(20900);let o={sendMsg:(e,t)=>{let i=s.M_.getState().sessions.currentSessionId;if(!i)return;let o=s.M_.getState().sessions.sessions.entities[i];if(!o)return;let r=Object.values((null==t?void 0:t.files)||{}).map(e=>({filename:e.fileObject.name,id:e.id,type:(0,n.cj)(e.fileObject.name),size:e.fileObject.size}));(0,a.C)({eventName:"new_session"===e?"new_session":"send_msg",extData:{sessionId:o.uid,model:o.agentTaskMode,fileNum:r.length,fileType:r.map(e=>e.type).join(","),fileSize:r.map(e=>e.size).join(",")}})},switchSession:e=>{let{sessionId:t}=e;if(!t)return;let i=s.M_.getState().sessions.sessions.entities[t];i&&(0,a.C)({eventName:"switch_session",extData:{sessionId:i.uid,model:i.agentTaskMode}})},fileUpload:e=>{let{sessionId:t,files:i,options:o}=e,r=t?s.M_.getState().sessions.sessions.entities[t]:null;(0,a.C)({eventName:"file_upload",extData:{sessionId:t,model:null==r?void 0:r.agentTaskMode,fileNum:null==i?void 0:i.length,fileType:null==i?void 0:i.map(e=>(0,n.cj)(e.name)).join(","),fileSize:null==i?void 0:i.map(e=>e.size).join(","),source:(null==o?void 0:o.source)||"local",mimeType:null==o?void 0:o.mimeType}})},showComputerDetail:e=>{let{source:t}=e,i=s.M_.getState().sessions.currentSessionId;if(!i)return;let n=s.M_.getState().sessions.sessions.entities[i];n&&(0,a.C)({eventName:"computer_detail",extData:{source:t,sessionId:n.uid,model:n.agentTaskMode}})},computerLiveJump:e=>{let{action:t}=e,i=s.M_.getState().sessions.currentSessionId;if(!i)return;let n=s.M_.getState().sessions.sessions.entities[i];n&&(0,a.C)({eventName:"computer_live_jump",extData:{sessionId:n.uid,model:n.agentTaskMode,action:t}})},computerUse:e=>{let{action:t}=e,i=s.M_.getState().sessions.currentSessionId;if(!i)return;let n=s.M_.getState().sessions.sessions.entities[i];n&&(0,a.C)({eventName:"computer_use",extData:{sessionId:n.uid,model:n.agentTaskMode,action:t}})},stopTask(e){(0,a.C)({eventName:"stop_task",extData:{sessionId:e}})}}},20900:(e,t,i)=>{i.d(t,{C:()=>g});var s=i(57271),n=i(89317),a=i(91452),o=i(29298),r=i(36076),l=i(97603),c=i(18952),d=i(12766),u=i(25511);class p{async getId(){return await (0,u.Hd)()}async getJsonData(){return await (0,u.n5)()}initOption(){this.currentIncludeOption=[...this.defaultIncludeOption],(0,u.qN)("exclude",["fonts","locales","permissions","plugins","system.browser.name","system.browser.version"])}changeIncludeOption(e){"string"==typeof e?this.currentIncludeOption=this.currentIncludeOption.includes(e)?this.currentIncludeOption.filter(t=>t!==e):[...this.currentIncludeOption,e]:this.currentIncludeOption=[...e],(0,u.qN)("include",this.currentIncludeOption)}constructor(){this.defaultIncludeOption=["audio","canvas","fonts","hardware","locales","math","permissions","plugins","screen","system","webgl"],this.currentIncludeOption=[],this.initOption()}}let v=new p;class m{push(e){e.extData||(e.extData={}),e.extData.url=window.location.href,this.events.push(e),this.doChecking()}doChecking(){this.timer&&this.clearTimer(),this.timer=setTimeout(()=>{this.send(),this.clearTimer()},this.interval)}clearTimer(){clearTimeout(this.timer),this.timer=null}async send(){var e,t;let i={...this.getClientInfo(),tmToken:await v.getId()},s={events:this.events,userInfo:this.getUserInfo(),clientInfo:i},n=l.K.formatToAmplitude(s);l.K.batchTrack(n),null===(t=navigator)||void 0===t||null===(e=t.sendBeacon)||void 0===e||e.call(t,"".concat(d.a.rpcServerUrl,"/api/user_behavior/batch_create_event_v2"),JSON.stringify((0,c.T)("server",s))),this.events=[]}constructor(e,t,i){this.interval=e,this.getUserInfo=t,this.getClientInfo=i,this.events=[],this.timer=null}}let f=new m(200,function(){var e;let t=a.M_.getState(),i=(null===(e=t.auth.userInfo)||void 0===e?void 0:e.membershipVersion)||o.b.Free;return{plan:i===o.b.Free?r.A.VipVersionForTrack.free:i===o.b.Pro?r.A.VipVersionForTrack.pro:i===o.b.Casual?r.A.VipVersionForTrack.starter:r.A.VipVersionForTrack.unknown,knowledgeEntryCount:t.knowledge.userKnowledgeList.length,sessionCount:t.sessions.sessions.ids.length}},function(){let e=new Date;return{clientId:n.n.clientId,clientType:"web",clientVersion:"",clientLocale:s.I.translationManager.locale,productName:"Manus",timezone:(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return}})(),timezoneOffset:e.getTimezoneOffset()}});function g(e){(Array.isArray(e)?e:[e]).map(e=>({...e,extData:{...e.extData},eventAt:new Date().toISOString()})).forEach(e=>{f.push(e)})}},98445:(e,t,i)=>{i.d(t,{C:()=>a.C,y:()=>r});var s=i(28921),n=i(91452),a=i(20900),o=i(75297);let r={app:s.G,chatBox:o.Q,chatOperation:{sessionDelete:e=>{let{sessionId:t}=e;if(!t)return;let i=n.M_.getState().sessions.sessions.entities[t];i&&(0,a.C)({eventName:"session_delete",extData:{sessionId:(null==i?void 0:i.uid)||"",model:null==i?void 0:i.agentTaskMode}})},sessionRename:e=>{let{sessionId:t}=e;if(!t)return;let i=n.M_.getState().sessions.sessions.entities[t];i&&(0,a.C)({eventName:"session_rename",extData:{sessionId:(null==i?void 0:i.uid)||"",model:null==i?void 0:i.agentTaskMode}})},sessionFavorite:e=>{let{sessionId:t,action:i}=e;if(!t)return;let s=n.M_.getState().sessions.sessions.entities[t];s&&(0,a.C)({eventName:"session_favorite",extData:{sessionId:(null==s?void 0:s.uid)||"",model:null==s?void 0:s.agentTaskMode,action:i}})},sessionFileView:()=>{let e=n.M_.getState().sessions.currentSessionId;if(!e)return;let t=n.M_.getState().sessions.sessions.entities[e];t&&(0,a.C)({eventName:"session_file_view",extData:{sessionId:(null==t?void 0:t.uid)||"",model:null==t?void 0:t.agentTaskMode}})},sessionFileClick:e=>{let{action:t}=e,i=n.M_.getState().sessions.currentSessionId;if(!i)return;let s=n.M_.getState().sessions.sessions.entities[i];s&&(0,a.C)({eventName:"session_file_click",extData:{sessionId:(null==s?void 0:s.uid)||"",model:null==s?void 0:s.agentTaskMode,action:t}})}},chatShare:{sessionShare:e=>{let{sessionId:t,type:i}=e;if(t&&n.M_.getState().sessions.sessions.entities[t]&&t){let e=n.M_.getState().sessions.sessions.entities[t];e&&(0,a.C)({eventName:"session_share",extData:{sessionId:(null==e?void 0:e.uid)||"",model:null==e?void 0:e.agentTaskMode,type:i}})}},sessionSharePublish:e=>{let{sessionId:t}=e;if(t&&n.M_.getState().sessions.sessions.entities[t]&&t){let e=n.M_.getState().sessions.sessions.entities[t];e&&(0,a.C)({eventName:"session_share_publish",extData:{sessionId:(null==e?void 0:e.uid)||"",model:null==e?void 0:e.agentTaskMode}})}},sessionSharePageShow:e=>{let{sessionInfo:t,type:i}=e;(0,a.C)({eventName:"session_sharepage_show",extData:{sessionId:(null==t?void 0:t.id)||"",model:null==t?void 0:t.agentTaskMode,type:i}})},sessionSharePageClick:e=>{let{sessionInfo:t,type:i,action:s}=e;(0,a.C)({eventName:"session_sharepage_click",extData:{sessionId:(null==t?void 0:t.id)||"",model:null==t?void 0:t.agentTaskMode,type:i,action:s}})}},biz:{upgradeClick:e=>{let{source:t}=e;(0,a.C)({eventName:"upgrade_click",extData:{source:t}})},buyCreditsClick:e=>{let{source:t}=e;(0,a.C)({eventName:"buy_credits_click",extData:{source:t}})},creditUsageClick:e=>{let{source:t}=e;(0,a.C)({eventName:"credits_usage_click",extData:{source:t}})},subscriptionManagement:()=>{(0,a.C)({eventName:"subscription_management"})},upgradeDialogShow:e=>{(0,a.C)({eventName:"upgrade_dialog_show",source:e})},upgradeDialogClick:e=>{let{planKey:t,source:i}=e;(0,a.C)({eventName:"upgrade_dialog_click",extData:{planKey:t},source:i})},buyCreditsDialogShow:()=>{(0,a.C)({eventName:"buy_credits_dialog_show"})},buyCreditsDialogClick:e=>{let{planKey:t}=e;(0,a.C)({eventName:"buy_credits_dialog_click",extData:{planKey:t}})},chatCreditsExhaustedCardShow:e=>{let{msgId:t}=e,i=n.M_.getState().sessions.currentSessionId;(0,a.C)({eventName:"chat_credits_exhausted_card_show",extData:{sessionId:i||"",msgId:t}})},cancelSubscriptionClick:()=>{(0,a.C)({eventName:"cancel_subscription_click"})},switchStarterShow:()=>{(0,a.C)({eventName:"switch_starter_show"})},switchStarterClick:()=>{(0,a.C)({eventName:"switch_starter_click"})},cancelSubscriptionPageShow:()=>{(0,a.C)({eventName:"cancel_subscription_page_show"})},keepSubscriptionClick:()=>{(0,a.C)({eventName:"keep_subscription_click"})},questionnaireInvitationPageShow:()=>{(0,a.C)({eventName:"questionnaire_invitation_page_show"})},questionnaireInvitationClick:()=>{(0,a.C)({eventName:"questionnaire_invitation_click"})}},taskStatus:{sessionAdSpaceShow:e=>{let{sessionId:t}=e;if(!t)return;let i=n.M_.getState().sessions.sessions.entities[t];i&&(0,a.C)({eventName:"session_ad_space_show",extData:{sessionId:i.uid,model:i.agentTaskMode}})},sessionAdSpaceClick:e=>{let{sessionId:t}=e;if(!t)return;let i=n.M_.getState().sessions.sessions.entities[t];i&&(0,a.C)({eventName:"session_ad_space_click",extData:{sessionId:i.uid,model:i.agentTaskMode}})},sessionAdRateShow:e=>{let{sessionId:t}=e;if(!t)return;let i=n.M_.getState().sessions.sessions.entities[t];i&&(0,a.C)({eventName:"session_ad_rate_show",extData:{sessionId:i.uid,model:i.agentTaskMode}})},sessionAdRateClick:e=>{let{sessionId:t,type:i}=e;if(!t)return;let s=n.M_.getState().sessions.sessions.entities[t];s&&(0,a.C)({eventName:"session_ad_rate_click",extData:{sessionId:s.uid,model:s.agentTaskMode,type:i}})},chatTaskCompletedShow:e=>{let{statusId:t}=e,i=n.M_.getState().sessions.currentSessionId;(0,a.C)({eventName:"chat_task_completed_show",extData:{sessionId:i||"",statusId:t}})}},onboarding:{onboardingShow:()=>{(0,a.C)({eventName:"onboarding_show",extData:{}})},onboardingSkipClick:()=>{(0,a.C)({eventName:"onboarding_skip_click",extData:{}})},onboardingConfirmClick:e=>{let{tags:t,other:i}=e;(0,a.C)({eventName:"onboarding_confirm_click",extData:{tags:t,other:i,num:t.length}})}},marketingCard:{galleryAdCardShow:e=>{let{cardName:t}=e;(0,a.C)({eventName:"instruction_card_show",extData:{cardName:t}})},galleryAdCardClick:e=>{let{cardName:t,action:i}=e;(0,a.C)({eventName:"instruction_card_click",extData:{cardName:t,action:i}})},galleryAdCardUrlShow:e=>{let{cardName:t,urlId:i}=e;(0,a.C)({eventName:"instruction_card_url_show",extData:{cardName:t,urlId:i}})},galleryAdCardPopupShow:e=>{let{cardName:t,pageIndex:i}=e;(0,a.C)({eventName:"instruction_card_popup_show",extData:{cardName:t,pageIndex:i}})},galleryAdCardPopupClick:e=>{let{cardName:t,pageIndex:i,button1Name:s,button2Name:n,action:o}=e;(0,a.C)({eventName:"instruction_card_popup_click",extData:{cardName:t,pageIndex:i,button1Name:s,button2Name:n,action:o}})}},sessionExample:{sessionExampleShow:e=>{let{title:t}=e;(0,a.C)({eventName:"session_example_show",extData:{title:t}})},sessionExampleClick:e=>{let{title:t}=e;(0,a.C)({eventName:"session_example_click",extData:{title:t}})}},tryItYourself:{tryInputBoxClick:e=>{let{sessionId:t,action:i}=e;t&&(0,a.C)({eventName:"try_input_box_click",extData:{caseSessionId:t,caseSessionUrl:"https://manus.im/share/"+t,action:i}})},tryPlanEditorEvent:e=>{let{sessionId:t,planStatus:i,errorType:s}=e;t&&(0,a.C)({eventName:"try_plan_editor_event",extData:{sessionId:t,planStatus:i,errorType:s}})},tryPlanEditorClick:e=>{let{sessionId:t,action:i}=e;t&&(0,a.C)({eventName:"try_plan_editor_click",extData:{sessionId:t,action:i}})}}}},36076:(e,t,i)=>{var s;i.d(t,{A:()=>s}),function(e){var t;(t=e.VipVersionForTrack||(e.VipVersionForTrack={}))[t.free=0]="free",t[t.pro=1]="pro",t[t.starter=2]="starter",t[t.unknown=-1]="unknown"}(s||(s={}))},21147:(e,t,i)=>{i.d(t,{$:()=>d,s:()=>c});var s=i(81820),n=i(62121),a=i(74958),o=i(99515),r=i(16834),l=i(21731);function c(){let e=(0,a.usePathname)();(0,o.useEffect)(()=>{let e=new URL(location.href).searchParams,t=e.get("utm_source"),i=e.get("utm_campaign");t&&localStorage.setItem(r.d5.utmSource,t),i&&localStorage.setItem(r.d5.utmCampaign,i)},[e])}function d(){return{firstFromPlatform:n.G.isRunInServerSide?"":s.d.isInApp()?s.d.isIosApp()?"ios":s.d.isAndroidApp()?"android":"app":(0,l.Fr)()?"h5":new URL(location.href).searchParams.get("from")||"web",utmSource:localStorage.getItem(r.d5.utmSource)||void 0,utmCampaign:localStorage.getItem(r.d5.utmCampaign)||void 0}}},18952:(e,t,i)=>{i.d(t,{T:()=>function e(t,i){return i?Array.isArray(i)?i.map(i=>e(t,i)):"object"==typeof i?Object.keys(i).reduce((n,a)=>{let o=i[a];return n["client"===t?s.snakeToCamel(a):s.camelToSnake(a)]=e(t,o),n},{}):i:i}});let s={snakeToCamel:e=>e.replace(/(_[a-z])/g,e=>e.toUpperCase().replace("_","")),camelToSnake:e=>e.replace(/([A-Z])/g,e=>"_".concat(e.toLowerCase())).replace(/^_/,"")}},5963:(e,t,i)=>{i.d(t,{qc:()=>s.qc,X7:()=>o,Om:()=>u});var s=i(92816),n=i(23693),a=i(76656);async function o(e,t){let i=async()=>{let i=await e(n.R.endpoints.getSession.initiate({sessionId:t,type:"private"},{forceRefetch:!0})).unwrap();return await s.xA.updateSession(i,!0),i},o=await s.xA.get(t);if(o&&o.events.length>0){let e=o.s3UrlExpireAt-Date.now();if(o.agentTaskMode===a.Ku.UNSPECIFIED)i();else{if(e<0)return await i();e<s.Al/2&&i()}return o}return await i()}let r=[],l=null,c=null,d=null,u={receiveNewEvent:async function(e,t,i){if(l!==t&&(l=t,r=[],d=null),c!==e&&(c=e,d=null,r=[]),"eventsNotifyEventsAfter"===i.type){d=i.eventId,await s.xA.pushConfirmedEvents(e,[...r,...i.events],i.eventId),r=[];return}if("chatDelta"!==i.type){if(d){await s.xA.pushConfirmedEvents(e,[...r,i],d),r=[];return}r.push(i)}},joinNewSession:async function(e,t){c!==e&&(c=e,r=[],d=null),l!==t&&(l=t,r=[],d=null)},startNewSession:async function(e,t,i){l=t,c=e,r=[]},updateSessionInNotify:async function(e,t){let{sessionId:i,type:a,title:o,iconInfo:r,costedCredits:l}=t;switch(a){case"info":return await s.xA.updateMeta(i,{title:o,iconInfo:r,costedCredits:l});case"deleted":return await s.xA.removeId(i);case"update":{if(i===c)return;let t=await s.xA.getLastEventId(i),a=await e(n.R.endpoints.getSession.initiate({sessionId:i,startEventId:t||void 0,type:"private"},{forceRefetch:!0})).unwrap();if(t)return await s.xA.pushConfirmedEvents(i,a.events,t);return await s.xA.updateSession(a,!0)}}}}},92816:(e,t,i)=>{i.d(t,{Al:()=>o,qc:()=>S,xA:()=>h});var s=i(76656),n=i(45571);let a=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i]},o=432e6,r=(e,t)=>{let i=new Map;for(let s of e){let e=t(s);i.has(e)||i.set(e,s)}return Array.from(i.values())},l="sessions",c="sessionEvents",d="metadata",u="session-list",p=null,v=15,m=async()=>(p||(p=await (0,n.P2)("session-cache",1,{upgrade(e){e.createObjectStore(l,{keyPath:"id"}),e.createObjectStore(c,{keyPath:"id"}).createIndex("by-session","sessionId"),e.createObjectStore(d).put({sessionIds:[]},u)}})),p);async function f(e){a("updateAccessTime",e);let t=(await m()).transaction([d],"readwrite"),i=t.objectStore(d),s=await i.get(u)||{sessionIds:[]};s.sessionIds=s.sessionIds.filter(t=>t!==e),s.sessionIds.unshift(e),await i.put(s,u),await t.done}async function g(){let e=(await m()).transaction([l,d,c],"readwrite"),t=e.objectStore(d),i=await t.get(u);if(i&&i.sessionIds.length>v){let s=i.sessionIds.slice(v),n=e.objectStore(l);a("remove",s),await Promise.all(s.map(async t=>{let i=e.objectStore(c).index("by-session"),s=await i.openCursor(t);for(;s;)await s.delete(),s=await s.continue();return n.delete(t)})),i.sessionIds=i.sessionIds.slice(0,v),await t.put(i,u)}await e.done}async function w(e){let t=await m(),i=await t.getAllFromIndex(c,"by-session",e);return a("getSessionEvents",e,i.length),i}let h={configure(e){e.maxSessions&&(v=e.maxSessions,g().catch(console.error))},async get(e){let t=await m(),i=await t.get(l,e);if(!i)return null;let s=await w(e);return await f(e),{...i,events:s,s3UrlExpireAt:i.s3UrlsExpiredAt||0}},async updateSession(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=await m(),{events:n,...a}=e,r=s.transaction([l,c],"readwrite"),d=await r.objectStore(l).get(e.id),u=[...e.events].sort((e,t)=>e.timestamp-t.timestamp);await r.objectStore(l).put({...a,lastEventId:null===(t=u[u.length-1])||void 0===t?void 0:t.id,s3UrlsExpiredAt:i?Date.now()+o:null==d?void 0:d.s3UrlsExpiredAt}),await Promise.all(u.map(t=>r.objectStore(c).put({...t,sessionId:e.id}))),await r.done,await f(e.id),await g()},async pushConfirmedEvents(e,t,i){let n=(await m()).transaction([l,c],"readwrite"),o=n.objectStore(l),d=await o.get(e),u=n.objectStore(c).index("by-session"),p=await u.getAll(e);if(d){if(!p.find(e=>e.id===i)&&"NEW_SESSION_EVENT"!==i){await n.done;return}let s=new Set(p.map(e=>e.id)),r=null,l=t.filter(e=>!s.has(e.id));for(let e of l)r?e.timestamp>r.timestamp&&(r=e):r=e;a("append events",d.id,l.length),await Promise.all(l.map(async t=>await n.objectStore(c).put({...t,sessionId:e}))),r&&(d.lastEventId=r.id),await o.put(d)}else{var v;let i=r(t,e=>e.id).sort((e,t)=>e.timestamp-t.timestamp);await o.put({id:e,title:"",lastEventId:null===(v=i[i.length-1])||void 0===v?void 0:v.id,agentTaskMode:s.Ku.UNSPECIFIED}),await Promise.all(i.map(t=>n.objectStore(c).put({...t,sessionId:e})))}await n.done,await f(e),await g()},async updateMeta(e,t){let i=(await m()).transaction(l,"readwrite"),n=i.objectStore(l),a=await n.get(e);a?(void 0!==t.title&&(a.title=t.title),void 0!==t.iconInfo&&(a.iconInfo=t.iconInfo),void 0!==t.costedCredits&&(a.costedCredits=t.costedCredits),await n.put(a)):await n.put({id:e,title:t.title||"",iconInfo:t.iconInfo,costedCredits:t.costedCredits||0,agentTaskMode:s.Ku.UNSPECIFIED}),await i.done,await f(e),await g()},async clear(){let e=await m();await e.clear(l),await e.clear(c),await e.put(d,{sessionIds:[]},u)},async removeId(e){let t=(await m()).transaction([l,d,c],"readwrite");await t.objectStore(l).delete(e);let i=t.objectStore(c).index("by-session"),s=await i.openCursor(e);for(;s;)await s.delete(),s=await s.continue();let n=t.objectStore(d),a=await n.get(u);a&&(a.sessionIds=a.sessionIds.filter(t=>t!==e),await n.put(a,u)),await t.done},async getLastEventId(e){try{let t=await m(),i=await t.get(l,e);return(null==i?void 0:i.lastEventId)||null}catch(e){return console.error(e),null}}},S=async()=>h.clear()},91452:(e,t,i)=>{i.d(t,{GV:()=>s.GV,M_:()=>s.M_,jL:()=>s.jL});var s=i(5685)},27846:(e,t,i)=>{i.d(t,{A:()=>D,v:()=>N});var s=i(75958),n=i(9205),a=i(97603),o=i(21147),r=i(16834),l=i(12766),c=i(59496),d=i(5963),u=i(88359),p=i(98445),v=i(21731),m=i(16577),f=i(93347),g=i(14132),w=i(78085),h=i(26865),S=i(68720),_=i(57271),I=i(59413),y=i(88672),C=i(5685),b=i(87963),k=i(2480),T=i(60498),x=i(40757),A=i(29298);let N=(0,h.tu)();function D(){let e=(0,y.wA)(),{initNotification:t}=(0,T.h)(),{initConnectors:i}=(0,k.U)(),{clearDraft:h}=(0,m.z)(),D=(0,s.w)(async function(e){let{redirectUrl:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new URL("".concat(l.a.rpcServerUrl,"/api/user/oauth2_authorize")),s=new URL(window.location.href);s.pathname=w.bw.authLanding.root,t&&s.searchParams.set("redirectUrl",t),i.searchParams.set("type",e),i.searchParams.set("redirect_url",s.toString()),i.searchParams.set("locale",_.I.translationManager.locale);let n=(0,o.$)();n.utmSource&&i.searchParams.set("utm_source",n.utmSource),n.utmCampaign&&i.searchParams.set("utm_campaign",n.utmCampaign),n.firstFromPlatform&&i.searchParams.set("first_from_platform",n.firstFromPlatform),i.searchParams.set("tz",Intl.DateTimeFormat().resolvedOptions().timeZone),i.searchParams.set("tz_offset",String(new Date().getTimezoneOffset())),window.location.href=i.toString()}),M=(0,s.w)(async()=>{e(x.R.actions.updateUserInfo(null)),(0,d.qc)(),I.A.remove(r.eu.loginSuccess),localStorage.removeItem(r.d5.UserInfo);try{h(),await (0,g.ri)()}catch(e){console.error(e)}I.A.remove("session_id"),location.href="".concat(w.bw.root,"?index=1")}),E=(0,s.w)(async t=>{let{verificationCode:i}=t;e(x.R.actions.updateUserInfo(null)),(0,d.qc)(),I.A.remove(r.eu.loginSuccess),localStorage.removeItem(r.d5.UserInfo),await (0,g.mz)({verificationCode:i}),I.A.remove("session_id"),location.href="".concat(w.bw.root,"?index=1")}),U=(0,s.w)(async e=>{let{action:t}=e;try{await (0,g.fy)({action:t})}catch(e){(0,n.oR)({variant:"error",title:c.P.formatErrorToString(e)})}}),P=(0,s.w)(async()=>{e(x.R.actions.setAuthLoading(!0));let t=await f.F.UserService.userInfo({}).finally(()=>{e(x.R.actions.setAuthLoading(!1))});t&&(a.K.setUserId(t.userId),a.K.customUserPropertyOne(a.d.Plan,a.K.formatMemberShipToNumber(t.membershipVersion||A.b.Free))),e(x.R.actions.setUserInfo(t))}),O=(0,s.w)(async()=>{let t=await f.F.UserService.getUserClientConfig({configKeys:[S.U4.RECV_MARKETING_EMAIL,S.U4.HAS_INTEREST]});e(x.R.actions.setClientConfig(t))}),R=(0,s.w)(async()=>{let t=await f.F.UserService.getAvailableCredits({});e(x.R.actions.updateUsageInfo(t))}),j=(0,s.w)(async s=>{let n=localStorage.getItem(r.d5.UserInfo),a=localStorage.getItem(r.d5.usageInfo),o=localStorage.getItem(r.d5.userClientConfig);e(x.R.actions.setCreditAnimateInfo(a?JSON.parse(a):null)),e(x.R.actions.setUserInfo(n?JSON.parse(n):null)),e(x.R.actions.updateUsageInfo(a?JSON.parse(a):null)),e(x.R.actions.setClientConfig(o?JSON.parse(o):null)),s&&(await Promise.all([P(),R(),O()]),V(),z(),i(),t()),N.markReady()}),L=(0,s.w)(async function(t){e(x.R.actions.setModifying(!0));try{e(x.R.actions.updateUserInfo({nickname:t.name})),await f.F.UserService.updateUserProfile({newNickname:t.name})}finally{e(x.R.actions.setModifying(!1))}}),F=(0,s.w)(async function(t){e(x.R.actions.setAvatarUploading(!0));try{var i;let s=await (0,v.pJ)(t.file,128),n=await (0,v.zM)(s),a=(null===(i=n.split(";")[1])||void 0===i?void 0:i.replace(/^base64,/,""))||"";await f.F.UserService.updateUserProfile({newAvatar:{fileName:t.file.name,mimeType:t.file.type,data:a}}),e(x.R.actions.updateUserInfo({avatar:n}))}catch(e){(0,n.oR)({variant:"error",title:c.P.formatErrorToString(e)})}finally{e(x.R.actions.setAvatarUploading(!1))}}),V=(0,s.w)(async()=>{let t=await f.F.UserPublicService.getGlobalSettings({});e(x.R.actions.setGlobalSettings(t))}),z=(0,s.w)(async function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];t&&e(x.R.actions.setInvitationCodeListLoading(!0));try{let t=await f.F.UserService.getPersonalInvitationCodes({}),i=u._.getItem("invitationCodeMaxUsed")||0,s=t.invitationCodes.reduce((e,t)=>e+t.maxUses,0);(0,p.C)({eventName:"invitation_code_list",extData:{count:s}});let n=C.M_.getState().auth.invitationCodeRedDotVisible;s>i&&(null===n?e(x.R.actions.setInvitationRedDotVisible(!0)):u._.setItem("invitationCodeMaxUsed",s)),e(x.R.actions.setInvitationCodeList(t.invitationCodes)),e(b.e.actions.setInvitationCodeLength(t.invitationCodes.length))}catch(e){console.error("init invitation code list error",e),(0,p.C)({eventName:"invitation_code_list",extData:{count:-1}})}e(x.R.actions.setInvitationCodeListLoading(!1))});return{handleLogout:M,handleLogoff:E,fetchEmailVerifyCodeWithAuth:U,fetchUserInfo:P,initAuth:j,handleLogin:D,modifyUserInfo:L,modifyUserAvatar:F,fetchInvitationCodeList:z,setUserConfig:(0,s.w)(async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{silent:!0},s={...C.M_.getState().auth.clientConfig};Object.entries(t).forEach(e=>{let[t,i]=e;s[t]=i}),i.silent&&e(x.R.actions.setClientConfig(s)),await f.F.UserService.setUserClientConfig(t),i.silent||e(x.R.actions.setClientConfig(s))}),sendInvitationEmail:(0,s.w)(async t=>{let{email:i,code:s}=t;try{let t=await f.F.UserService.sendInvitationEmail({email:i,code:s});if(void 0!==t.pending){let i=C.M_.getState().auth.invitationCodeList.map(e=>e.inviteCode===s?{...e,pending:!!t.pending}:e);e(x.R.actions.setInvitationCodeList(i))}return(0,n.oR)({variant:"success",title:_.I.t("Email sent successfully")}),!0}catch(e){if(e.details&&e.details[0]&&"400401"===e.details[0].debug.code)return"400401";return console.error("init invitation code list error",e),(0,n.oR)({variant:"error",title:c.P.formatErrorToString(e)}),!1}})}}},2480:(e,t,i)=>{i.d(t,{U:()=>u});var s=i(75958),n=i(18214),a=i(93347),o=i(26865),r=i(57271),l=i(91452),c=i(60537);let d=(0,o.tu)();function u(){let e=(0,l.jL)(),t=(0,s.w)(async()=>{try{await i()}catch(e){console.error(e)}d.markReady()}),i=(0,s.w)(async()=>{let t=await a.F.UserService.getConnectAPP({});e(c.h.actions.setConnectors(t.connectApp))}),o=(0,s.w)(async e=>{if("google_drive"===e){let e=await a.F.UserService.getGoogleDriveAuthUrl({callbackRedirect:window.location.href});window.location.href=e.url}else throw Error(r.I.t("Unsupported connect app type"))}),u=(0,s.w)(async t=>{if("google_drive"===t)await a.F.UserService.disconnectAPP({type:t}),e(c.h.actions.disconnectApp(t)),i();else throw Error(r.I.t("Unsupported connect app type"))}),p=(0,s.w)(async e=>{if(await d.waitReady(),"google_drive"===e){let e=c.h.selectors.googleDriceConnector(l.M_.getState());if(null==e?void 0:e.connected){var t;if(null===(t=e.connectInfo)||void 0===t?void 0:t.expireTime){let t=Date.now();if(new Date(n.F.protoTimestampToDate(e.connectInfo.expireTime)).getTime()-t<3e5){await i();return}}}else await o("google_drive")}});return{initConnectors:t,fetchConnectors:i,connectApp:o,disconnectApp:u,checkConnectStatus:p}}},60498:(e,t,i)=>{i.d(t,{h:()=>l});var s=i(75958),n=i(16834),a=i(93347),o=i(91452),r=i(4331);function l(){let e=(0,o.jL)(),t=(0,s.w)(async()=>{await i(void 0,!0)}),i=(0,s.w)(async function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(r.y.actions.setFetchNotificationListLoading(!0));try{var s,l;let c=await a.F.NotificationService.getNotificationList({latestUid:t,limit:10}),d=c.data||[];if(d.length<10?e(r.y.actions.setHasMoreNotification(!1)):e(r.y.actions.setHasMoreNotification(!0)),i&&d.length>0){let t=null===(s=c.data[0])||void 0===s?void 0:s.uid,i=localStorage.getItem(n.d5.latestNotificationId);t!==i&&e(r.y.actions.setHasNew(!0))}if(t){let t=r.y.selectors.notificationList(o.M_.getState());e(r.y.actions.setNotificationList([...t,...d]))}else e(r.y.actions.setNotificationList(d)),(null===(l=d[0])||void 0===l?void 0:l.uid)&&localStorage.setItem(n.d5.latestNotificationId,d[0].uid)}catch(e){console.error("Failed to fetch version history:",e)}finally{e(r.y.actions.setFetchNotificationListLoading(!1))}});return{initNotification:t,fetchNotificationList:i}}},16577:(e,t,i)=>{i.d(t,{V:()=>l,z:()=>d});var s=i(98637),n=i(75958),a=i(16834),o=i(91452),r=i(92749);let l="DRAFT_TASK_SESSION_ID";class c{static generateDraft(e,t){return{...t,sessionId:null!=e?e:l,createdAt:Date.now()}}static storeDraft(e){let t=JSON.stringify(this.formatDraftListOnStore(e));localStorage.setItem(a.d5.inputBoxDraftList,t)}static readDraftBySessionIdList(){let e=localStorage.getItem(a.d5.inputBoxDraftList);return e?JSON.parse(e):[]}static readDraftBySessionId(e){let t=null!=e?e:l;return this.readDraftBySessionIdList().find(e=>e.sessionId===t)||null}static formatDraftListOnStore(e){return e.map(e=>{var t,i;return{...e,content:{...e.content,files:null===(i=e.content)||void 0===i?void 0:null===(t=i.files)||void 0===t?void 0:t.map(e=>{var t,i,s;return{...e,fileObject:{name:null===(t=e.fileObject)||void 0===t?void 0:t.name,size:null===(i=e.fileObject)||void 0===i?void 0:i.size,type:null===(s=e.fileObject)||void 0===s?void 0:s.type}}})}}})}}function d(){let e=(0,o.jL)(),t=(0,n.w)(e=>{let t=null!=e?e:l,i=c.readDraftBySessionIdList().filter(e=>e.sessionId!==t);c.storeDraft(i)}),i=(0,s.x)((0,n.w)(e=>{let i=c.readDraftBySessionId(null!=e?e:l),s=o.M_.getState().chat.inputValue,n=o.M_.getState().chat.files,a=i&&!s.length&&!n.length;if((i||a)&&t(i.sessionId),a)return null;let r=c.readDraftBySessionIdList(),d=null,u={content:{text:s,files:n}};d=i?{...i,...u,createdAt:Date.now()}:c.generateDraft(e,u),r.push(d);let p=r.length;return p>=5&&r.splice(0,p-5),c.storeDraft(r),d}),300);return{loadDraft:(0,n.w)(t=>{var i,s;let n=c.readDraftBySessionId(t);if(!n)return;let a=null!==(i=n.content.files)&&void 0!==i?i:[],o=null!==(s=n.content.text)&&void 0!==s?s:"";e(r.V.actions.setInputValue(o)),a.forEach(t=>e(r.V.actions.fileAdded(t)))}),saveDraft:i,removeDraft:t,clearDraft:(0,n.w)(()=>{c.storeDraft([])})}}},81820:(e,t,i)=>{i.d(t,{d:()=>o});var s=i(62121),n=i(21731);function a(e){try{var t,i,s,a,o,r,l,c;let d=(0,n.hU)();if("Android"===d){if(!(null===(t=window.flutter_inappwebview)||void 0===t?void 0:t.callHandler))throw Error("[SendMsgToApp][Android] JSBridge method not exist");null===(s=window.flutter_inappwebview)||void 0===s||null===(i=s.callHandler)||void 0===i||i.call(s,"android",e);return}if(!(null===(r=window.webkit)||void 0===r?void 0:null===(o=r.messageHandlers)||void 0===o?void 0:null===(a=o.nativeHandler)||void 0===a?void 0:a.postMessage))throw Error("[SendMsgToApp][IOS] JSBridge method not exist");null===(l=(c=window.webkit.messageHandlers.nativeHandler).postMessage)||void 0===l||l.call(c,JSON.stringify(e));return}catch(e){console.error("[SendMsgToApp] error: ".concat(e.toString()))}}let o={isInApp:()=>{var e,t;return!s.G.isRunInServerSide&&!!(null===(t=window)||void 0===t?void 0:null===(e=t.manusAppEnv)||void 0===e?void 0:e.manusApp)},isIosApp:()=>{var e,t,i,n,a;return!s.G.isRunInServerSide&&!!((null===(t=window)||void 0===t?void 0:null===(e=t.manusAppEnv)||void 0===e?void 0:e.manusApp)&&(null===(a=window.webkit)||void 0===a?void 0:null===(n=a.messageHandlers)||void 0===n?void 0:null===(i=n.nativeHandler)||void 0===i?void 0:i.postMessage))},isAndroidApp:()=>{var e,t,i;return!s.G.isRunInServerSide&&!!((null===(t=window)||void 0===t?void 0:null===(e=t.manusAppEnv)||void 0===e?void 0:e.manusApp)&&(null===(i=window.flutter_inappwebview)||void 0===i?void 0:i.callHandler))},setSession:e=>{a({event:"setSession",data:e})},closeWebview:e=>{a({event:"closeWebview",data:e})},getVisitorInfo:()=>(function(e){try{var t,i,s,a,o,r;let l=(0,n.hU)();if("Android"===l){if(!(null===(t=window.flutter_inappwebview)||void 0===t?void 0:t.callHandler))throw Error("[receiveMsgFromApp][Android] JSBridge method not exist");return window.flutter_inappwebview.callHandler("android",e)}if(!(null===(a=window.webkit)||void 0===a?void 0:null===(s=a.messageHandlers)||void 0===s?void 0:null===(i=s.nativeHandler)||void 0===i?void 0:i.postMessage))throw Error("[receiveMsgFromApp][IOS] JSBridge method not exist");return null===(o=(r=window.webkit.messageHandlers.nativeHandler).postMessage)||void 0===o?void 0:o.call(r,JSON.stringify(e))}catch(e){console.error("[receiveMsgFromApp] error: ".concat(e.toString()))}})({event:"getVisitorInfo"})}},14132:(e,t,i)=>{i.d(t,{l4:()=>d,mz:()=>m,ri:()=>g,Nj:()=>h,zo:()=>u,vy:()=>w,pu:()=>v,fy:()=>f,LB:()=>p});var s=i(12766),n=i(20948),a=i(18952),o=i(24990);class r extends Error{constructor(e,t){super(e),this.msg=e,this.code=t}}async function l(e,t,i){let l=new URL(e,s.a.rpcServerUrl);"GET"===t&&Object.entries(i).forEach(e=>{let[t,i]=e;(0,n.A)(i)||l.searchParams.set(t,i)});let c=new Headers;await (0,o.q)(c,{setApiKey:!0}),"POST"===t&&c.set("Content-Type","application/json");let d=await fetch(l.toString(),{method:t,mode:"cors",credentials:"include",headers:c,body:"POST"===t?JSON.stringify((0,a.T)("server",i)):void 0});if(!d.ok)throw Error("Network error: ".concat(d.status," - ").concat(d.statusText));let u=d.headers.get("Content-Type");if(!(null==u?void 0:u.includes("application/json")))throw Error("Not a json response");let p=await d.json();if(0!==p.code)throw new r(p.msg,p.code);return(0,a.T)("client",p)}async function c(e,t,i,r){let l=new URL(e,s.a.rpcServerUrl);"GET"===t&&Object.entries(i).forEach(e=>{let[t,i]=e;(0,n.A)(i)||l.searchParams.set(t,i)});let c=new Headers;await (0,o.q)(c,{setApiKey:!0}),"POST"===t&&c.set("Content-Type","application/json");try{await fetch(l.toString(),{method:t,mode:"cors",credentials:"include",headers:c,body:"POST"===t?JSON.stringify((0,a.T)("server",i)):void 0}).then(e=>e.blob()).then(e=>{let t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=r,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(t)})}catch(e){throw Error("Network error: ".concat(e.status," - ").concat(e.statusText))}}function d(e){return l("/api/user/login_by_email","POST",e)}function u(e){return l("/api/user/register_by_email","POST",e)}function p(e){return l("/api/user/send_email_verify_code_with_captcha","POST",e)}function v(e){return l("/api/user/reset_password_with_captcha","POST",e)}function m(e){return l("/api/user/logoff","POST",e)}function f(e){return l("/api/user/send_email_verify_code_with_auth","POST",e)}function g(){return l("/api/user/logout","GET",{})}function w(e){return l("/api/user/reset_password_with_auth","POST",e)}function h(e,t){return c("/md2pdf/convert","POST",e,t)}}}]);